<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wakatamu premises</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/emoji-picker/1.1.5/emoji-picker.min.css">
    <style>
        /* CSS Variables */
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --success-color: #4cc9f0;
            --danger-color: #f72585;
            --warning-color: #f8961e;
            --info-color: #7209b7;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-radius: 10px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --sidebar-width: 250px;
            --header-height: 70px;
            --bg-brightness: 100%;
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            transition: var(--transition);
            filter: brightness(var(--bg-brightness));
        }

        body.dark-mode {
            background: #121212;
            color: #e0e0e0;
        }

        body.dark-mode .container {
            background: #1e1e1e;
        }

        /* Loading Animations */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 12px;
            margin-bottom: 8px;
        }

        .skeleton-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e0e0e0;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s ease;
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        .slide-up {
            animation: slideUp 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            background: white;
            border-radius: var(--border-radius);
            padding: 15px 20px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(400px);
            animation: slideIn 0.3s forwards;
            border-left: 4px solid var(--primary-color);
        }

        .toast.success {
            border-left-color: #28a745;
        }

        .toast.error {
            border-left-color: var(--danger-color);
        }

        .toast.warning {
            border-left-color: var(--warning-color);
        }

        .toast.info {
            border-left-color: var(--info-color);
        }

        @keyframes slideIn {
            to { transform: translateX(0); }
        }

        @keyframes slideOut {
            from { transform: translateX(0); }
            to { transform: translateX(400px); }
        }

        .toast.hide {
            animation: slideOut 0.3s forwards;
        }

        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            white-space: nowrap;
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--dark-color) transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Sound Notification */
        .sound-notification {
            position: fixed;
            bottom: 100px;
            right: 20px;
            z-index: 9998;
            background: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s forwards;
            max-width: 300px;
        }

        .sound-notification.hide {
            animation: slideOut 0.3s forwards;
        }

        .sound-notification i {
            font-size: 20px;
        }

        .sound-notification-content {
            flex: 1;
        }

        .sound-notification-title {
            font-weight: bold;
            font-size: 14px;
        }

        .sound-notification-message {
            font-size: 12px;
            opacity: 0.9;
        }

        .sound-notification-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 18px;
        }

        /* Signup Disabled Overlay */
        .signup-disabled-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: var(--border-radius);
            z-index: 100;
            backdrop-filter: blur(5px);
        }

        .signup-disabled-content {
            background: white;
            padding: 30px;
            border-radius: var(--border-radius);
            text-align: center;
            max-width: 400px;
            margin: 20px;
            box-shadow: var(--box-shadow);
        }

        .signup-disabled-content i {
            font-size: 48px;
            color: var(--warning-color);
            margin-bottom: 15px;
        }

        .signup-disabled-content h3 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .signup-disabled-content p {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        body.dark-mode .signup-disabled-content {
            background: #252525;
        }

        body.dark-mode .signup-disabled-content h3 {
            color: #e0e0e0;
        }

        body.dark-mode .signup-disabled-content p {
            color: #aaa;
        }

        /* Signup Countdown */
        .signup-countdown {
            background: rgba(67, 97, 238, 0.1);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: 15px;
        }

        .countdown-timer {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .countdown-label {
            font-size: 14px;
            color: #666;
        }

        /* Schedule Timer */
        .schedule-timer {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            text-align: center;
        }

        .schedule-timer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .schedule-timer-title {
            font-weight: bold;
            font-size: 16px;
        }

        .schedule-timer-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 12px;
        }

        .schedule-timer-time {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
            font-family: monospace;
        }

        .schedule-timer-message {
            font-size: 12px;
            opacity: 0.9;
        }

        /* Friend System */
        .friend-list-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .friend-list-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .friend-list-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .online-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4CAF50;
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid white;
        }

        body.dark-mode .online-status {
            border-color: #2d2d2d;
        }

        .mutual-friends {
            font-size: 12px;
            color: #666;
        }

        .friend-request-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-radius: var(--border-radius);
            margin-bottom: 10px;
            background: #f8f9fa;
        }

        body.dark-mode .friend-request-item {
            background: #2d2d2d;
        }

        .friend-request-actions {
            display: flex;
            gap: 5px;
        }

        /* Media Viewer */
        .media-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .media-viewer.active {
            display: flex;
        }

        .media-viewer-content {
            max-width: 90%;
            max-height: 90%;
            position: relative;
        }

        .media-viewer img, .media-viewer video {
            max-width: 100%;
            max-height: 100%;
            border-radius: 8px;
        }

        .media-viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 30px;
            cursor: pointer;
            z-index: 10000;
        }

        /* Quick Actions */
        .quick-actions {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .quick-action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .quick-action-btn:hover {
            transform: scale(1.1);
        }

        /* Backup & Restore */
        .backup-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
        }

        body.dark-mode .backup-card {
            background: #252525;
        }

        .backup-history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        body.dark-mode .backup-history-item {
            border-bottom: 1px solid #444;
        }

        /* Background Options */
        .bg-option {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .bg-option:hover, .bg-option.active {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .bg-gradient-blue {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .bg-gradient-green {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .bg-gradient-orange {
            background: linear-gradient(135deg, #f46b45 0%, #eea849 100%);
        }

        .bg-gradient-purple {
            background: linear-gradient(135deg, #4776E6 0%, #8E54E9 100%);
        }

        .bg-solid-dark {
            background: #121212;
        }

        .bg-solid-light {
            background: #f5f7fb;
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .visible {
            display: block !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        /* Auth Pages Container */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        /* Auth Box */
        .auth-box {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            width: 100%;
            max-width: 500px;
            padding: 40px;
            animation: fadeIn 0.5s ease;
            position: relative;
        }

        body.dark-mode .auth-box {
            background: #252525;
            color: #e0e0e0;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        body.dark-mode .form-label {
            color: #e0e0e0;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
        }

        body.dark-mode .form-control {
            background: #333;
            border-color: #444;
            color: #e0e0e0;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-col {
            flex: 1;
        }

        /* Button Styles */
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            text-decoration: none;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(67, 97, 238, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-block {
            width: 100%;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-danger {
            background: var(--danger-color);
        }

        .btn-warning {
            background: var(--warning-color);
        }

        .btn-info {
            background: var(--info-color);
        }

        /* Notification Box */
        .notification {
            padding: 15px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .notification.info {
            background: rgba(33, 150, 243, 0.1);
            border-left: 4px solid #2196F3;
        }

        .notification.warning {
            background: rgba(255, 193, 7, 0.1);
            border-left: 4px solid #ffc107;
        }

        .notification.success {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
        }

        .notification.error {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid #dc3545;
        }

        /* Homepage Layout */
        .homepage {
            display: none;
            min-height: 100vh;
            background: #f5f7fb;
        }

        body.dark-mode .homepage {
            background: #121212;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            z-index: 1000;
        }

        body.dark-mode .header {
            background: #1e1e1e;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* User Info */
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
        }

        .user-role {
            font-size: 12px;
            color: #666;
        }

        /* Main Layout */
        .main-layout {
            display: flex;
            min-height: calc(100vh - var(--header-height));
            margin-top: var(--header-height);
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            padding: 20px 0;
            transition: var(--transition);
            overflow-y: auto;
            height: calc(100vh - var(--header-height));
            position: fixed;
            left: 0;
        }

        body.dark-mode .sidebar {
            background: #1e1e1e;
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar.collapsed .menu-text {
            display: none;
        }

        .sidebar.collapsed .menu-item {
            justify-content: center;
            padding: 15px;
        }

        .menu {
            list-style: none;
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            color: var(--dark-color);
            text-decoration: none;
        }

        body.dark-mode .menu-item {
            color: #e0e0e0;
        }

        .menu-item:hover,
        .menu-item.active {
            background: rgba(67, 97, 238, 0.1);
            border-left-color: var(--primary-color);
        }

        .menu-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
            color: var(--primary-color);
        }

        .menu-text {
            flex: 1;
            font-weight: 500;
        }

        .badge {
            background: var(--danger-color);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: auto;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            margin-left: var(--sidebar-width);
            transition: var(--transition);
            overflow-y: auto;
            max-height: calc(100vh - var(--header-height));
        }

        .sidebar.collapsed + .main-content {
            margin-left: 70px;
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        body.dark-mode .card {
            background: #252525;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .card-icon {
            font-size: 24px;
            color: var(--primary-color);
        }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .card-footer {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }

        /* Table Styles */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        body.dark-mode .table-container {
            background: #252525;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        body.dark-mode .table th,
        body.dark-mode .table td {
            border-bottom: 1px solid #444;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: var(--dark-color);
        }

        body.dark-mode .table th {
            background: #2d2d2d;
            color: #e0e0e0;
        }

        .table tr:hover {
            background: rgba(67, 97, 238, 0.05);
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .status-suspended {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .status-inactive {
            background: rgba(108, 117, 125, 0.2);
            color: #6c757d;
        }

        .status-banned {
            background: rgba(220, 53, 69, 0.3);
            color: #dc3545;
            border: 1px solid #dc3545;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            background: #f8f9fa;
            color: var(--dark-color);
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .action-btn.edit {
            background: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .action-btn.delete {
            background: rgba(247, 37, 133, 0.1);
            color: var(--danger-color);
        }

        /* Form Section */
        .form-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
        }

        body.dark-mode .form-section {
            background: #252525;
        }

        .section-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }

        body.dark-mode .modal-content {
            background: #252525;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .modal-title {
            color: var(--primary-color);
            margin-bottom: 20px;
        }

        /* Brightness Slider */
        .brightness-slider {
            width: 100%;
            margin: 20px 0;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }

            .sidebar .menu-text {
                display: none;
            }

            .sidebar .menu-item {
                justify-content: center;
                padding: 15px;
            }

            .main-content {
                margin-left: 70px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 0 15px;
            }

            .main-content {
                padding: 20px;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .quick-actions {
                bottom: 10px;
                right: 10px;
            }

            .quick-action-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        body.dark-mode ::-webkit-scrollbar-track {
            background: #2d2d2d;
        }

        body.dark-mode ::-webkit-scrollbar-thumb {
            background: #555;
        }

        body.dark-mode ::-webkit-scrollbar-thumb:hover {
            background: #777;
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--box-shadow);
        }

        body.dark-mode .stat-card {
            background: #252525;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
        }

        /* Activity Timeline */
        .activity-timeline {
            position: relative;
            padding-left: 30px;
        }

        .activity-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--primary-color);
        }

        .activity-item {
            position: relative;
            margin-bottom: 20px;
            padding-left: 20px;
        }

        .activity-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary-color);
        }

        .activity-time {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .activity-text {
            font-size: 14px;
        }

        /* Signup Status Badge */
        .signup-status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .signup-enabled {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .signup-disabled {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        /* Signup Schedule Section */
        .signup-schedule-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .signup-schedule-card h4 {
            margin-bottom: 10px;
            color: white;
        }

        .schedule-time-inputs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .schedule-time-inputs input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .schedule-time-inputs input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Sound Notification Container -->
    <div id="soundNotificationContainer"></div>

    <!-- Loading Overlay -->
    <div class="modal" id="loadingOverlay">
        <div class="modal-content" style="background:transparent; box-shadow:none;">
            <div class="loader"></div>
            <p style="text-align:center; color:white; margin-top:20px;" id="loadingText">Loading...</p>
        </div>
    </div>

    <!-- Media Viewer -->
    <div class="media-viewer" id="mediaViewer">
        <div class="media-viewer-close" onclick="closeMediaViewer()">&times;</div>
        <div class="media-viewer-content" id="mediaViewerContent"></div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <button class="quick-action-btn tooltip" onclick="scrollToTop()" title="Scroll to Top">
            <i class="fas fa-arrow-up"></i>
        </button>
        <button class="quick-action-btn tooltip" onclick="toggleSound()" title="Toggle Sound" id="soundToggleBtn">
            <i class="fas fa-volume-up" id="soundIcon"></i>
        </button>
    </div>

    <!-- Login Page -->
    <div class="auth-container" id="loginPage">
        <div class="auth-box">
            <div class="auth-header">
                <h1 class="auth-title">System Login</h1>
                <p class="auth-subtitle">Welcome back! Please login to continue</p>
            </div>

            <div class="notification info" id="loginNotification" style="display:none;">
                <span id="loginNotificationText"></span>
                <button class="btn" onclick="hideNotification('loginNotification')" style="float:right; padding:5px 10px; font-size:12px;">Cancel</button>
            </div>

            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail" class="form-label">Email or Username</label>
                    <input type="text" id="loginEmail" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="loginPassword" class="form-label">Password</label>
                    <input type="password" id="loginPassword" class="form-control" required>
                </div>

                <button type="submit" class="btn btn-block">Login</button>
            </form>

            <div class="auth-links" style="text-align:center; margin-top:20px;">
                <a href="#" class="auth-link" onclick="showPage('signupPage')">Create Account</a>
                <span> | </span>
                <a href="#" class="auth-link" onclick="showPage('forgotPasswordPage')">Forgot Password?</a>
            </div>
        </div>
    </div>

    <!-- Signup Page -->
    <div class="auth-container" id="signupPage" style="display:none;">
        <div class="auth-box">
            <!-- Signup Disabled Overlay -->
            <div class="signup-disabled-overlay" id="signupDisabledOverlay" style="display:none;">
                <div class="signup-disabled-content">
                    <i class="fas fa-user-slash"></i>
                    <h3>New Signups Temporarily Disabled</h3>
                    <p>We are currently not accepting new user registrations. Please try again later when signups are enabled by the administrator.</p>
                    
                    <!-- Signup Schedule Timer -->
                    <div class="schedule-timer" id="signupPageScheduleTimer" style="display:none;">
                        <div class="schedule-timer-header">
                            <div class="schedule-timer-title">Signup Schedule</div>
                            <div class="schedule-timer-status" id="signupPageScheduleStatus">Starting Soon</div>
                        </div>
                        <div class="schedule-timer-time" id="signupPageScheduleTime">00:00:00</div>
                        <div class="schedule-timer-message" id="signupPageScheduleMessage">Signups will open in</div>
                    </div>
                    
                    <div id="signupScheduleInfo" style="display:none; margin-top:15px; font-size:14px; background:rgba(67, 97, 238, 0.1); padding:10px; border-radius:5px;">
                        <i class="fas fa-clock"></i> Signups are scheduled to open on: <strong id="scheduledDate"></strong>
                    </div>
                    <div class="signup-countdown" id="signupCountdown" style="display:none;">
                        <div class="countdown-timer" id="countdownTimer">00:00:00</div>
                        <div class="countdown-label">Until signups reopen</div>
                    </div>
                    <button class="btn btn-primary" onclick="showPage('loginPage')" style="margin-top:20px;">
                        Back to Login
                    </button>
                </div>
            </div>

            <div class="auth-header">
                <h1 class="auth-title">Create Account</h1>
                <p class="auth-subtitle">Join our platform today</p>
            </div>

            <div class="notification info" id="signupNotification" style="display:none;">
                <span id="signupNotificationText"></span>
                <button class="btn" onclick="hideNotification('signupNotification')" style="float:right; padding:5px 10px; font-size:12px;">Cancel</button>
            </div>

            <form id="signupForm">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupUsername" class="form-label">Username</label>
                            <input type="text" id="signupUsername" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupFullName" class="form-label">Full Name</label>
                            <input type="text" id="signupFullName" class="form-control" required>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupNickname" class="form-label">Nickname</label>
                            <input type="text" id="signupNickname" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupEmail" class="form-label">Email</label>
                            <input type="email" id="signupEmail" class="form-control" required>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupPhone" class="form-label">Phone</label>
                            <input type="tel" id="signupPhone" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupCountry" class="form-label">Country</label>
                            <select id="signupCountry" class="form-control" required>
                                <option value="">Select Country</option>
                                <option value="US">United States</option>
                                <option value="UK">United Kingdom</option>
                                <option value="CA">Canada</option>
                                <option value="AU">Australia</option>
                                <option value="KE">Kenya</option>
                                <option value="NG">Nigeria</option>
                                <option value="ZA">South Africa</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupCountryCode" class="form-label">Country Code</label>
                            <input type="text" id="signupCountryCode" class="form-control" placeholder="+1" required>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupDob" class="form-label">Date of Birth</label>
                            <input type="date" id="signupDob" class="form-control" required>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupGender" class="form-label">Gender</label>
                            <select id="signupGender" class="form-control" required>
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                                <option value="prefer-not-to-say">Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupPassword" class="form-label">Password</label>
                            <input type="password" id="signupPassword" class="form-control" required>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="signupConfirmPassword" class="form-label">Confirm Password</label>
                            <input type="password" id="signupConfirmPassword" class="form-control" required>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-block" id="signupSubmitBtn">Create Account</button>
            </form>

            <div class="auth-links" style="text-align:center; margin-top:20px;">
                <a href="#" class="auth-link" onclick="showPage('loginPage')">Already have an account? Login</a>
            </div>
        </div>
    </div>

    <!-- Forgot Password Page -->
    <div class="auth-container" id="forgotPasswordPage" style="display:none;">
        <div class="auth-box">
            <div class="auth-header">
                <h1 class="auth-title">Reset Password</h1>
                <p class="auth-subtitle">Enter your email to reset password</p>
            </div>

            <div class="notification info" id="forgotNotification" style="display:none;">
                <span id="forgotNotificationText"></span>
                <button class="btn" onclick="hideNotification('forgotNotification')" style="float:right; padding:5px 10px; font-size:12px;">Cancel</button>
            </div>

            <form id="forgotPasswordForm">
                <div class="form-group">
                    <label for="forgotEmail" class="form-label">Email Address</label>
                    <input type="email" id="forgotEmail" class="form-control" required>
                </div>

                <button type="submit" class="btn btn-block">Request Password Reset</button>
            </form>

            <div class="auth-links" style="text-align:center; margin-top:20px;">
                <a href="#" class="auth-link" onclick="showPage('loginPage')">Back to Login</a>
            </div>
        </div>
    </div>

    <!-- Verification Page -->
    <div class="auth-container" id="verificationPage" style="display:none;">
        <div class="auth-box">
            <div class="auth-header">
                <h1 class="auth-title">Verify Identity</h1>
                <p class="auth-subtitle">Please verify your identity to continue</p>
            </div>

            <div class="notification info" id="verificationNotification" style="display:none;">
                <span id="verificationNotificationText"></span>
            </div>

            <form id="verificationForm">
                <div class="form-group">
                    <label for="verifyNickname" class="form-label">Nickname</label>
                    <input type="text" id="verifyNickname" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="verifyDob" class="form-label">Date of Birth</label>
                            <input type="date" id="verifyDob" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="verifyPhone" class="form-label">Phone Number</label>
                    <input type="tel" id="verifyPhone" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="verifyCountryCode" class="form-label">Country Code</label>
                    <input type="text" id="verifyCountryCode" class="form-control" required>
                </div>

                <button type="submit" class="btn btn-block">Verify Identity</button>
            </form>
        </div>
    </div>

    <!-- Password Update Page -->
    <div class="auth-container" id="passwordUpdatePage" style="display:none;">
        <div class="auth-box">
            <div class="auth-header">
                <h1 class="auth-title">Update Password</h1>
                <p class="auth-subtitle">Set your new password</p>
            </div>

            <div class="notification info" id="passwordUpdateNotification" style="display:none;">
                <span id="passwordUpdateNotificationText"></span>
            </div>

            <div class="notification success" id="autoGeneratedPassword" style="display:none;">
                <p><strong>Auto-generated Password:</strong> <span id="generatedPasswordText"></span></p>
                <p style="font-size:14px; margin-top:5px;">This password was generated by admin</p>
            </div>

            <form id="passwordUpdateForm">
                <div class="form-group">
                    <label for="newPassword" class="form-label">New Password</label>
                    <input type="password" id="newPassword" class="form-control" required>
                </div>

                <div class="form-group">
                    <label for="confirmNewPassword" class="form-label">Confirm New Password</label>
                    <input type="password" id="confirmNewPassword" class="form-control" required>
                </div>

                <button type="submit" class="btn btn-block">Update Password</button>
            </form>

            <div class="auth-links" style="margin-top:20px;">
                <button class="btn btn-success btn-block" onclick="useGeneratedPassword()">Keep Auto-generated Password</button>
                <div style="text-align:center; margin-top:10px;">
                    <a href="#" class="auth-link" onclick="showPage('loginPage')">Back to Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Homepage -->
    <div class="homepage" id="adminHomepage">
        <div class="header">
            <div class="logo">Admin Panel</div>
            <div class="header-actions">
                <div class="maintenance-toggle">
                    <span>Maintenance:</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="maintenanceToggle">
                        <span class="toggle-slider"></span>
                    </label>
                    <span id="maintenanceStatus">OFF</span>
                </div>
                <div class="user-info">
                    <div class="avatar" id="adminAvatar">
                        <div id="adminAvatarText">A</div>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="adminName">Administrator</div>
                        <div class="user-role">Admin</div>
                    </div>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <div class="sidebar" id="adminSidebar">
                <ul class="menu">
                    <li class="menu-item active" data-page="dashboard">
                        <i class="menu-icon fas fa-tachometer-alt"></i>
                        <span class="menu-text">Dashboard</span>
                    </li>
                    <li class="menu-item" data-page="userManagement">
                        <i class="menu-icon fas fa-users"></i>
                        <span class="menu-text">User Management</span>
                        <span class="badge" id="pendingSignupCount">0</span>
                    </li>
                    <li class="menu-item" data-page="notifications">
                        <i class="menu-icon fas fa-bell"></i>
                        <span class="menu-text">Notifications</span>
                        <span class="badge" id="adminNotificationCount">0</span>
                    </li>
                    <li class="menu-item" data-page="passwordRequests">
                        <i class="menu-icon fas fa-key"></i>
                        <span class="menu-text">Password Requests</span>
                        <span class="badge" id="passwordRequestCount">0</span>
                    </li>
                    <li class="menu-item" data-page="systemReset">
                        <i class="menu-icon fas fa-redo"></i>
                        <span class="menu-text">System Reset</span>
                    </li>
                    <li class="menu-item" data-page="systemSettings">
                        <i class="menu-icon fas fa-cog"></i>
                        <span class="menu-text">Settings</span>
                        <span class="signup-status-badge" id="signupStatusBadge"></span>
                    </li>
                    <li class="menu-item" data-page="adminProfile">
                        <i class="menu-icon fas fa-user-cog"></i>
                        <span class="menu-text">Profile</span>
                    </li>
                    <li class="menu-item" data-page="activityLogs">
                        <i class="menu-icon fas fa-history"></i>
                        <span class="menu-text">Activity Logs</span>
                    </li>
                    <li class="menu-item" data-page="backupRestore">
                        <i class="menu-icon fas fa-database"></i>
                        <span class="menu-text">Backup & Restore</span>
                    </li>
                </ul>
            </div>

            <div class="main-content" id="adminContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- User Homepage -->
    <div class="homepage" id="userHomepage">
        <div class="header">
            <div class="logo">User Portal</div>
            <div class="header-actions">
                <div class="user-info">
                    <div class="avatar" id="userAvatar">
                        <div id="userAvatarText">U</div>
                    </div>
                    <div class="user-details">
                        <div class="user-name" id="userName">User</div>
                        <div class="user-role" id="userStatus">Active</div>
                    </div>
                    <button class="btn btn-danger" onclick="logout()">Logout</button>
                </div>
            </div>
        </div>

        <div class="main-layout">
            <div class="sidebar" id="userSidebar">
                <ul class="menu">
                    <li class="menu-item active" data-page="userDashboard">
                        <i class="menu-icon fas fa-tachometer-alt"></i>
                        <span class="menu-text">Dashboard</span>
                    </li>
                    <li class="menu-item" data-page="userProfile">
                        <i class="menu-icon fas fa-user"></i>
                        <span class="menu-text">View Profile</span>
                    </li>
                    <li class="menu-item" data-page="editProfile">
                        <i class="menu-icon fas fa-edit"></i>
                        <span class="menu-text">Edit Profile</span>
                    </li>
                    <li class="menu-item" data-page="userNotifications">
                        <i class="menu-icon fas fa-bell"></i>
                        <span class="menu-text">Notifications</span>
                        <span class="badge" id="userNotificationCount">0</span>
                    </li>
                    <li class="menu-item" data-page="changePassword">
                        <i class="menu-icon fas fa-key"></i>
                        <span class="menu-text">Change Password</span>
                    </li>
                    <li class="menu-item" data-page="appearance">
                        <i class="menu-icon fas fa-palette"></i>
                        <span class="menu-text">Appearance</span>
                    </li>
                    <li class="menu-item" data-page="settings">
                        <i class="menu-icon fas fa-cog"></i>
                        <span class="menu-text">Settings</span>
                    </li>
                </ul>
            </div>

            <div class="main-content" id="userContent">
                <!-- Content will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal('confirmationModal')">&times;</div>
            <h3 class="modal-title" id="confirmationTitle">Confirm Action</h3>
            <p id="confirmationMessage">Are you sure you want to perform this action?</p>
            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="btn btn-danger" id="confirmActionBtn" onclick="confirmAction()">Confirm</button>
                <button class="btn" onclick="closeModal('confirmationModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Avatar Upload Modal -->
    <div class="modal" id="avatarUploadModal">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal('avatarUploadModal')">&times;</div>
            <h3 class="modal-title">Upload Avatar</h3>
            <div class="form-group">
                <label class="form-label">Select Image</label>
                <input type="file" id="avatarUploadInput" accept="image/*" class="form-control">
            </div>
            <div id="avatarPreview" style="text-align:center; margin:20px 0;">
                <img id="avatarPreviewImg" style="max-width:200px; max-height:200px; border-radius:50%; display:none;">
            </div>
            <button class="btn btn-success btn-block" onclick="saveAvatar()">Save Avatar</button>
        </div>
    </div>

    <!-- Background Settings Modal -->
    <div class="modal" id="backgroundModal">
        <div class="modal-content">
            <div class="modal-close" onclick="closeModal('backgroundModal')">&times;</div>
            <h3 class="modal-title">Background Settings</h3>
            
            <div class="form-section">
                <h4>Select Background</h4>
                <div style="display:flex; gap:10px; flex-wrap:wrap; margin:15px 0;">
                    <div class="bg-option bg-gradient-blue active" onclick="selectBackground('gradient-blue')"></div>
                    <div class="bg-option bg-gradient-green" onclick="selectBackground('gradient-green')"></div>
                    <div class="bg-option bg-gradient-orange" onclick="selectBackground('gradient-orange')"></div>
                    <div class="bg-option bg-gradient-purple" onclick="selectBackground('gradient-purple')"></div>
                    <div class="bg-option bg-solid-dark" onclick="selectBackground('solid-dark')"></div>
                    <div class="bg-option bg-solid-light" onclick="selectBackground('solid-light')"></div>
                </div>
            </div>
            
            <div class="form-section">
                <h4>Brightness Control</h4>
                <div class="form-group">
                    <label class="form-label">Adjust Brightness: <span id="brightnessValue">100%</span></label>
                    <input type="range" id="brightnessSlider" class="brightness-slider" min="50" max="150" value="100" oninput="updateBrightness(this.value)">
                </div>
            </div>
            
            <div class="form-section">
                <h4>Dark/Light Mode</h4>
                <div class="form-group">
                    <label class="toggle-switch">
                        <input type="checkbox" id="darkModeToggle" onchange="toggleDarkMode()">
                        <span class="toggle-slider"></span>
                    </label>
                    <span style="margin-left:10px;">Dark Mode</span>
                </div>
            </div>
            
            <button class="btn btn-success btn-block" onclick="saveBackgroundSettings()">Save Settings</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/emoji-picker/1.1.5/emoji-picker.min.js"></script>
    <script>
        // Enhanced Global Variables
        let currentUser = null;
        let currentPage = 'dashboard';
        let currentAction = null;
        let actionData = null;
        let failedLoginAttempts = {};
        let verificationAttempts = 0;
        let systemMaintenance = false;
        let resetRequestEmail = null;
        let messageAutoDeleteDays = 30;
        let selectedFile = null;
        let notificationSound = null;
        let loginAttempts = {};
        const MAX_LOGIN_ATTEMPTS = 3;
        let signupCountdownInterval = null;
        let adminScheduleInterval = null;
        let audioContext = null;
        let soundEnabled = true;

        // Sound Configuration
        const sounds = {
            notification: {
                frequencies: [523.25, 659.25, 783.99, 1046.50],
                durations: [0.1, 0.1, 0.1, 0.3]
            },
            success: {
                frequencies: [523.25, 659.25, 783.99, 1046.50],
                durations: [0.15, 0.15, 0.15, 0.4]
            },
            error: {
                frequencies: [523.25, 493.88, 440.00, 392.00],
                durations: [0.1, 0.1, 0.1, 0.3]
            },
            login: {
                frequencies: [523.25, 659.25, 783.99],
                durations: [0.15, 0.15, 0.3]
            },
            logout: {
                frequencies: [783.99, 659.25, 523.25],
                durations: [0.15, 0.15, 0.3]
            }
        };

        // Admin Credentials
        const adminCredentials = {
            username: 'admin',
            email: 'admin@admin.com',
            password: 'admin123'
        };

        // Initialize System
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
            setupEventListeners();
            loadSystemSettings();
            setupKeyboardShortcuts();
            initializeAudio();
            
            // Check if user is already logged in
            const loggedInUser = localStorage.getItem('currentUser');
            if (loggedInUser) {
                const user = JSON.parse(loggedInUser);
                loginUser(user);
            }
            
            // Initialize failed login attempts
            failedLoginAttempts = JSON.parse(localStorage.getItem('failedLoginAttempts')) || {};
            loginAttempts = JSON.parse(localStorage.getItem('loginAttempts')) || {};
            
            // Set default admin credentials if not exists
            if (!localStorage.getItem('admin')) {
                createAdminUser();
            }
            
            // Check for pending notifications
            checkPendingNotifications();
            
            // Check signup status
            checkSignupStatus();
            
            // Check sound settings
            checkSoundSettings();
            
            // Start schedule timer if needed
            startScheduleTimer();
        });

        // Initialize Audio System
        function initializeAudio() {
            try {
                if (window.AudioContext || window.webkitAudioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            } catch (error) {
                console.error("Failed to initialize audio:", error);
            }
        }

        // Play Sound
        function playSound(type = 'notification') {
            if (!soundEnabled || !audioContext) return;
            
            try {
                const soundConfig = sounds[type] || sounds.notification;
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(soundConfig.frequencies[0], audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.01);
                
                let currentTime = audioContext.currentTime;
                soundConfig.frequencies.forEach((freq, index) => {
                    oscillator.frequency.setValueAtTime(freq, currentTime);
                    gainNode.gain.setValueAtTime(0.3, currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, currentTime + soundConfig.durations[index]);
                    currentTime += soundConfig.durations[index];
                });
                
                oscillator.start();
                oscillator.stop(currentTime);
                
                oscillator.onended = function() {
                    oscillator.disconnect();
                    gainNode.disconnect();
                };
            } catch (error) {
                console.error("Error playing sound:", error);
            }
        }

        // Toggle Sound
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const soundIcon = document.getElementById('soundIcon');
            const soundToggleBtn = document.getElementById('soundToggleBtn');
            
            if (soundEnabled) {
                soundIcon.className = 'fas fa-volume-up';
                soundToggleBtn.title = 'Sound: ON';
                showSoundNotification('Sound Enabled', 'Sound notifications are now enabled');
                playSound('success');
            } else {
                soundIcon.className = 'fas fa-volume-mute';
                soundToggleBtn.title = 'Sound: OFF';
                showSoundNotification('Sound Disabled', 'Sound notifications are now disabled');
            }
            
            const settings = JSON.parse(localStorage.getItem('systemSettings')) || {};
            settings.soundEnabled = soundEnabled;
            localStorage.setItem('systemSettings', JSON.stringify(settings));
        }

        // Check Sound Settings
        function checkSoundSettings() {
            const settings = JSON.parse(localStorage.getItem('systemSettings')) || {};
            soundEnabled = settings.soundEnabled !== false;
            
            const soundIcon = document.getElementById('soundIcon');
            const soundToggleBtn = document.getElementById('soundToggleBtn');
            
            if (soundEnabled) {
                soundIcon.className = 'fas fa-volume-up';
                soundToggleBtn.title = 'Sound: ON';
            } else {
                soundIcon.className = 'fas fa-volume-mute';
                soundToggleBtn.title = 'Sound: OFF';
            }
        }

        // Show Sound Notification
        function showSoundNotification(title, message) {
            const container = document.getElementById('soundNotificationContainer');
            const notificationId = 'sound-notif-' + Date.now();
            
            const notification = document.createElement('div');
            notification.className = 'sound-notification';
            notification.id = notificationId;
            notification.innerHTML = `
                <i class="fas fa-volume-up"></i>
                <div class="sound-notification-content">
                    <div class="sound-notification-title">${title}</div>
                    <div class="sound-notification-message">${message}</div>
                </div>
                <button class="sound-notification-close" onclick="dismissSoundNotification('${notificationId}')">&times;</button>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                dismissSoundNotification(notificationId);
            }, 3000);
        }

        // Dismiss Sound Notification
        function dismissSoundNotification(notificationId) {
            const notification = document.getElementById(notificationId);
            if (notification) {
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }
        }

        // Setup Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Escape to close modals
                if (e.key === 'Escape') {
                    closeAllModals();
                }
                
                // Ctrl+M to toggle sound
                if (e.ctrlKey && e.key === 'm') {
                    e.preventDefault();
                    toggleSound();
                }
            });
        }

        // Initialize Enhanced System
        function initializeSystem() {
            // Initialize admin user
            if (!localStorage.getItem('admin')) {
                createAdminUser();
            }
            
            // Initialize users array if not exists
            if (!localStorage.getItem('users')) {
                localStorage.setItem('users', JSON.stringify([]));
            }
            
            // Initialize notifications if not exists
            if (!localStorage.getItem('notifications')) {
                localStorage.setItem('notifications', JSON.stringify([]));
            }
            
            // Initialize activities if not exists
            if (!localStorage.getItem('activities')) {
                localStorage.setItem('activities', JSON.stringify([]));
            }
            
            // Initialize password requests if not exists
            if (!localStorage.getItem('passwordRequests')) {
                localStorage.setItem('passwordRequests', JSON.stringify([]));
            }
            
            // Initialize system settings if not exists
            if (!localStorage.getItem('systemSettings')) {
                const settings = {
                    maintenance: false,
                    darkMode: false,
                    background: 'gradient-blue',
                    brightness: 100,
                    fontSize: 'medium',
                    language: 'en',
                    allowSignups: true,
                    allowPasswordReset: true,
                    signupScheduleEnabled: false,
                    signupScheduleStart: null,
                    signupScheduleEnd: null,
                    soundEnabled: true
                };
                localStorage.setItem('systemSettings', JSON.stringify(settings));
            }
            
            // Initialize user settings if not exists
            if (!localStorage.getItem('userSettings')) {
                localStorage.setItem('userSettings', JSON.stringify({}));
            }
            
            // Initialize avatar storage
            if (!localStorage.getItem('avatars')) {
                localStorage.setItem('avatars', JSON.stringify({}));
            }
        }

        // Create Admin User
        function createAdminUser() {
            const adminUser = {
                id: 'admin-001',
                username: adminCredentials.username,
                fullName: 'System Administrator',
                nickname: 'Admin',
                email: adminCredentials.email,
                phone: '+1234567890',
                country: 'US',
                countryCode: '+1',
                dob: '1980-01-01',
                gender: 'male',
                avatar: 'A',
                password: adminCredentials.password,
                role: 'admin',
                status: 'active',
                createdAt: new Date().toISOString(),
                lastLogin: null,
                lastLogout: null,
                lastSeen: new Date().toISOString(),
                online: true,
                loginHistory: []
            };
            localStorage.setItem('admin', JSON.stringify(adminUser));
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
            
            // Signup form
            document.getElementById('signupForm').addEventListener('submit', function(e) {
                e.preventDefault();
                signup();
            });
            
            // Forgot password form
            document.getElementById('forgotPasswordForm').addEventListener('submit', function(e) {
                e.preventDefault();
                requestPasswordReset();
            });
            
            // Verification form
            document.getElementById('verificationForm').addEventListener('submit', function(e) {
                e.preventDefault();
                verifyIdentity();
            });
            
            // Password update form
            document.getElementById('passwordUpdateForm').addEventListener('submit', function(e) {
                e.preventDefault();
                updatePassword();
            });
            
            // Admin menu items
            document.querySelectorAll('#adminHomepage .menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    loadAdminPage(page);
                    this.classList.add('active');
                    document.querySelectorAll('#adminHomepage .menu-item').forEach(i => {
                        if (i !== this) i.classList.remove('active');
                    });
                });
            });
            
            // User menu items
            document.querySelectorAll('#userHomepage .menu-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    loadUserPage(page);
                    this.classList.add('active');
                    document.querySelectorAll('#userHomepage .menu-item').forEach(i => {
                        if (i !== this) i.classList.remove('active');
                    });
                });
            });
            
            // Maintenance toggle
            const maintenanceToggle = document.getElementById('maintenanceToggle');
            if (maintenanceToggle) {
                maintenanceToggle.addEventListener('change', toggleMaintenanceMode);
            }
            
            // Avatar upload
            const avatarUpload = document.getElementById('avatarUploadInput');
            if (avatarUpload) {
                avatarUpload.addEventListener('change', previewAvatar);
            }
            
            // Online status simulation
            setInterval(updateOnlineStatus, 30000);
            
            // Auto check signup status
            setInterval(checkSignupStatus, 60000);
        }

        // Show Loading
        function showLoading(message = 'Loading...') {
            document.getElementById('loadingText').textContent = message;
            showModal('loadingOverlay');
        }

        // Hide Loading
        function hideLoading() {
            closeModal('loadingOverlay');
        }

        // Show Toast Notification
        function showToast(title, message, type = 'info', duration = 5000) {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = toastId;
            toast.innerHTML = `
                <i class="toast-icon ${icons[type] || icons.info}" style="font-size:20px;"></i>
                <div class="toast-content">
                    <div class="toast-title" style="font-weight:bold;">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="dismissToast('${toastId}')" style="background:none; border:none; font-size:20px; cursor:pointer;">&times;</button>
            `;
            
            toastContainer.appendChild(toast);
            
            if (soundEnabled) {
                switch(type) {
                    case 'success':
                        playSound('success');
                        break;
                    case 'error':
                        playSound('error');
                        break;
                    case 'warning':
                    case 'info':
                        playSound('notification');
                        break;
                }
            }
            
            setTimeout(() => {
                dismissToast(toastId);
            }, duration);
            
            return toastId;
        }

        // Dismiss Toast
        function dismissToast(toastId) {
            const toast = document.getElementById(toastId);
            if (toast) {
                toast.classList.add('hide');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }
        }

        // Show Notification
        function showNotification(elementId, message, type = 'info', duration = 180000) {
            const notification = document.getElementById(elementId);
            const textElement = document.getElementById(elementId + 'Text');
            
            if (notification && textElement) {
                notification.className = `notification ${type}`;
                textElement.textContent = message;
                notification.style.display = 'block';
                
                if (duration > 0) {
                    setTimeout(() => {
                        notification.style.display = 'none';
                    }, duration);
                }
            }
        }

        // Hide Notification
        function hideNotification(elementId) {
            const notification = document.getElementById(elementId);
            if (notification) {
                notification.style.display = 'none';
            }
        }

        // Show Page
        function showPage(pageId) {
            document.querySelectorAll('.auth-container').forEach(page => {
                page.style.display = 'none';
            });
            
            document.getElementById(pageId).style.display = 'flex';
            
            if (pageId === 'signupPage') {
                checkSignupStatus();
                updateSignupPageScheduleTimer();
            }
        }

        // Show Modal
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        // Close Modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Close All Modals
        function closeAllModals() {
            document.querySelectorAll('.modal.show').forEach(modal => {
                modal.classList.remove('show');
            });
        }

        // Scroll to Top
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Load System Settings
        function loadSystemSettings() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            if (settings) {
                systemMaintenance = settings.maintenance;
                soundEnabled = settings.soundEnabled !== false;
                
                const maintenanceToggle = document.getElementById('maintenanceToggle');
                const maintenanceStatus = document.getElementById('maintenanceStatus');
                if (maintenanceToggle && maintenanceStatus) {
                    maintenanceToggle.checked = systemMaintenance;
                    maintenanceStatus.textContent = systemMaintenance ? 'ON' : 'OFF';
                }
                
                if (settings.darkMode) {
                    document.body.classList.add('dark-mode');
                }
                
                applyBackground(settings.background);
                
                if (settings.brightness) {
                    document.documentElement.style.setProperty('--bg-brightness', `${settings.brightness}%`);
                    const brightnessSlider = document.getElementById('brightnessSlider');
                    const brightnessValue = document.getElementById('brightnessValue');
                    if (brightnessSlider && brightnessValue) {
                        brightnessSlider.value = settings.brightness;
                        brightnessValue.textContent = `${settings.brightness}%`;
                    }
                }
                
                const darkModeToggle = document.getElementById('darkModeToggle');
                if (darkModeToggle) {
                    darkModeToggle.checked = settings.darkMode;
                }
                
                updateSignupStatusBadge();
                
                const soundIcon = document.getElementById('soundIcon');
                const soundToggleBtn = document.getElementById('soundToggleBtn');
                if (soundIcon && soundToggleBtn) {
                    if (soundEnabled) {
                        soundIcon.className = 'fas fa-volume-up';
                        soundToggleBtn.title = 'Sound: ON';
                    } else {
                        soundIcon.className = 'fas fa-volume-mute';
                        soundToggleBtn.title = 'Sound: OFF';
                    }
                }
            }
        }

        // Update Signup Status Badge
        function updateSignupStatusBadge() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            const signupStatusBadge = document.getElementById('signupStatusBadge');
            if (signupStatusBadge) {
                if (settings.allowSignups) {
                    signupStatusBadge.textContent = 'Signups ON';
                    signupStatusBadge.className = 'signup-status-badge signup-enabled';
                } else {
                    signupStatusBadge.textContent = 'Signups OFF';
                    signupStatusBadge.className = 'signup-status-badge signup-disabled';
                }
            }
        }

        // Check Signup Status
        function checkSignupStatus() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            if (!settings) return;
            
            const signupDisabledOverlay = document.getElementById('signupDisabledOverlay');
            const signupForm = document.getElementById('signupForm');
            const signupSubmitBtn = document.getElementById('signupSubmitBtn');
            const signupScheduleInfo = document.getElementById('signupScheduleInfo');
            const scheduledDate = document.getElementById('scheduledDate');
            const signupCountdown = document.getElementById('signupCountdown');
            const signupPageScheduleTimer = document.getElementById('signupPageScheduleTimer');
            
            if (signupDisabledOverlay && signupForm && signupSubmitBtn) {
                if (!settings.allowSignups) {
                    signupDisabledOverlay.style.display = 'flex';
                    signupForm.style.opacity = '0.5';
                    signupForm.style.pointerEvents = 'none';
                    signupSubmitBtn.disabled = true;
                    
                    if (settings.signupScheduleEnabled && settings.signupScheduleEnd) {
                        const scheduleEnd = new Date(settings.signupScheduleEnd);
                        const scheduleStart = settings.signupScheduleStart ? new Date(settings.signupScheduleStart) : null;
                        const now = new Date();
                        
                        if (signupPageScheduleTimer) {
                            signupPageScheduleTimer.style.display = 'block';
                            updateSignupPageScheduleTimer();
                        }
                        
                        if (scheduleEnd > now) {
                            signupScheduleInfo.style.display = 'block';
                            scheduledDate.textContent = formatDate(scheduleEnd);
                            
                            signupCountdown.style.display = 'block';
                            updateSignupCountdown(scheduleEnd);
                            
                            if (signupCountdownInterval) {
                                clearInterval(signupCountdownInterval);
                            }
                            signupCountdownInterval = setInterval(() => {
                                updateSignupCountdown(scheduleEnd);
                                updateSignupPageScheduleTimer();
                            }, 1000);
                        }
                    }
                } else {
                    signupDisabledOverlay.style.display = 'none';
                    signupForm.style.opacity = '1';
                    signupForm.style.pointerEvents = 'auto';
                    signupSubmitBtn.disabled = false;
                    
                    if (signupPageScheduleTimer) {
                        signupPageScheduleTimer.style.display = 'none';
                    }
                    
                    if (signupCountdownInterval) {
                        clearInterval(signupCountdownInterval);
                        signupCountdownInterval = null;
                    }
                    
                    signupScheduleInfo.style.display = 'none';
                    signupCountdown.style.display = 'none';
                }
            }
            
            startScheduleTimer();
        }

        // Start Schedule Timer
        function startScheduleTimer() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            
            if (adminScheduleInterval) {
                clearInterval(adminScheduleInterval);
                adminScheduleInterval = null;
            }
            
            if (settings.signupScheduleEnabled && (settings.signupScheduleStart || settings.signupScheduleEnd)) {
                adminScheduleInterval = setInterval(() => {
                    updateAdminScheduleTimer();
                    updateSignupPageScheduleTimer();
                    
                    const now = new Date();
                    const scheduleEnd = new Date(settings.signupScheduleEnd);
                    
                    if (scheduleEnd && now > scheduleEnd) {
                        settings.allowSignups = true;
                        settings.signupScheduleEnabled = false;
                        localStorage.setItem('systemSettings', JSON.stringify(settings));
                        
                        createNotification('admin', 'Signup Schedule Ended', 
                            'The signup schedule has ended. Signups are now enabled.', 'info');
                        
                        if (adminScheduleInterval) {
                            clearInterval(adminScheduleInterval);
                            adminScheduleInterval = null;
                        }
                        
                        if (signupCountdownInterval) {
                            clearInterval(signupCountdownInterval);
                            signupCountdownInterval = null;
                        }
                        
                        updateSignupStatusBadge();
                        checkSignupStatus();
                        if (currentUser && currentUser.role === 'admin' && currentPage === 'dashboard') {
                            loadAdminPage('dashboard');
                        }
                    }
                }, 1000);
            }
        }

        // Update Admin Schedule Timer
        function updateAdminScheduleTimer() {
            const adminScheduleTimer = document.getElementById('adminScheduleTimer');
            if (!adminScheduleTimer) return;
            
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            if (!settings.signupScheduleEnabled) return;
            
            const now = new Date();
            const scheduleStart = settings.signupScheduleStart ? new Date(settings.signupScheduleStart) : null;
            const scheduleEnd = settings.signupScheduleEnd ? new Date(settings.signupScheduleEnd) : null;
            
            if (!scheduleEnd) return;
            
            let diff = scheduleEnd - now;
            let status = 'Active';
            let message = 'Signups will close in';
            
            if (scheduleStart && now < scheduleStart) {
                diff = scheduleStart - now;
                status = 'Starting Soon';
                message = 'Signups will open in';
            } else if (now > scheduleEnd) {
                status = 'Ended';
                message = 'Schedule has ended';
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            const timerTime = document.getElementById('adminScheduleTime');
            const timerStatus = document.getElementById('adminScheduleStatus');
            const timerMessage = document.getElementById('adminScheduleMessage');
            
            if (timerTime && timerStatus && timerMessage) {
                timerTime.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                timerStatus.textContent = status;
                timerMessage.textContent = message;
            }
        }

        // Update Signup Page Schedule Timer
        function updateSignupPageScheduleTimer() {
            const signupPageScheduleTimer = document.getElementById('signupPageScheduleTimer');
            if (!signupPageScheduleTimer || signupPageScheduleTimer.style.display === 'none') return;
            
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            if (!settings.signupScheduleEnabled) return;
            
            const now = new Date();
            const scheduleStart = settings.signupScheduleStart ? new Date(settings.signupScheduleStart) : null;
            const scheduleEnd = settings.signupScheduleEnd ? new Date(settings.signupScheduleEnd) : null;
            
            if (!scheduleEnd) return;
            
            let diff, status, message;
            
            if (scheduleStart && now < scheduleStart) {
                diff = scheduleStart - now;
                status = 'Starting Soon';
                message = 'Signups will open in';
            } else if (now >= scheduleStart && now <= scheduleEnd) {
                diff = scheduleEnd - now;
                status = 'Active';
                message = 'Signups will close in';
            } else {
                status = 'Ended';
                message = 'Schedule has ended';
                diff = 0;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            const timerTime = document.getElementById('signupPageScheduleTime');
            const timerStatus = document.getElementById('signupPageScheduleStatus');
            const timerMessage = document.getElementById('signupPageScheduleMessage');
            
            if (timerTime && timerStatus && timerMessage) {
                if (diff > 0) {
                    timerTime.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    timerTime.textContent = '00:00:00';
                }
                timerStatus.textContent = status;
                timerMessage.textContent = message;
            }
        }

        // Update Signup Countdown
        function updateSignupCountdown(scheduleEnd) {
            const now = new Date();
            const diff = scheduleEnd - now;
            
            if (diff <= 0) {
                const settings = JSON.parse(localStorage.getItem('systemSettings'));
                settings.allowSignups = true;
                settings.signupScheduleEnabled = false;
                localStorage.setItem('systemSettings', JSON.stringify(settings));
                
                createNotification('admin', 'Signup Schedule Ended', 
                    'The signup schedule has ended. Signups are now enabled.', 'info');
                
                if (signupCountdownInterval) {
                    clearInterval(signupCountdownInterval);
                    signupCountdownInterval = null;
                }
                
                checkSignupStatus();
                updateSignupStatusBadge();
                
                return;
            }
            
            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            const countdownTimer = document.getElementById('countdownTimer');
            if (countdownTimer) {
                countdownTimer.textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        // Apply Background
        function applyBackground(bgType) {
            const backgrounds = {
                'gradient-blue': 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                'gradient-green': 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)',
                'gradient-orange': 'linear-gradient(135deg, #f46b45 0%, #eea849 100%)',
                'gradient-purple': 'linear-gradient(135deg, #4776E6 0%, #8E54E9 100%)',
                'solid-dark': '#121212',
                'solid-light': '#f5f7fb'
            };
            
            if (bgType === 'solid-dark' || bgType === 'solid-light') {
                document.body.style.background = backgrounds[bgType];
            } else {
                document.body.style.background = backgrounds[bgType];
            }
            
            document.querySelectorAll('.bg-option').forEach(opt => {
                opt.classList.remove('active');
                if (opt.classList.contains(`bg-${bgType.replace('-', '-')}`)) {
                    opt.classList.add('active');
                }
            });
        }

        // Select Background
        function selectBackground(bgType) {
            applyBackground(bgType);
        }

        // Update Brightness
        function updateBrightness(value) {
            document.documentElement.style.setProperty('--bg-brightness', `${value}%`);
            document.getElementById('brightnessValue').textContent = `${value}%`;
        }

        // Toggle Dark Mode
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        // Save Background Settings
        function saveBackgroundSettings() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            const activeBg = document.querySelector('.bg-option.active');
            const bgType = activeBg ? activeBg.classList[1].replace('bg-', '') : 'gradient-blue';
            const brightness = document.getElementById('brightnessSlider').value;
            const darkMode = document.getElementById('darkModeToggle').checked;
            
            settings.background = bgType;
            settings.brightness = parseInt(brightness);
            settings.darkMode = darkMode;
            
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            closeModal('backgroundModal');
            showToast('Settings Saved', 'Background settings have been updated.', 'success');
        }

        // Open Background Modal
        function openBackgroundModal() {
            showModal('backgroundModal');
        }

        // Check Pending Notifications
        function checkPendingNotifications() {
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            const pending = notifications.filter(n => !n.read && n.recipient === (currentUser ? currentUser.id : 'admin'));
            
            if (pending.length > 0 && currentUser) {
                showToast('New Notifications', `You have ${pending.length} unread notifications`, 'info');
            }
        }

        // Login Function
        async function login() {
            showLoading('Authenticating...');
            
            try {
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                const attemptKey = email.toLowerCase();
                loginAttempts[attemptKey] = loginAttempts[attemptKey] || { count: 0, lastAttempt: null };
                
                if (loginAttempts[attemptKey].lastAttempt) {
                    const lastAttempt = new Date(loginAttempts[attemptKey].lastAttempt);
                    const now = new Date();
                    const diffMinutes = (now - lastAttempt) / (1000 * 60);
                    if (diffMinutes > 15) {
                        loginAttempts[attemptKey].count = 0;
                    }
                }
                
                if (loginAttempts[attemptKey].count >= MAX_LOGIN_ATTEMPTS) {
                    hideLoading();
                    showNotification('loginNotification', 'Too many failed attempts. Your account has been suspended. Please contact admin.', 'error', 180000);
                    
                    const users = JSON.parse(localStorage.getItem('users'));
                    const user = users.find(u => u.email === email || u.username === email);
                    if (user) {
                        user.status = 'suspended';
                        localStorage.setItem('users', JSON.stringify(users));
                        
                        logActivity('system', 'login', `User ${user.username} suspended due to too many failed login attempts`);
                        
                        createNotification('admin', 'Account Suspended', 
                            `User ${user.username} has been suspended due to ${MAX_LOGIN_ATTEMPTS} failed login attempts.`, 'warning');
                    }
                    
                    return;
                }
                
                const settings = JSON.parse(localStorage.getItem('systemSettings'));
                if (settings && settings.maintenance) {
                    const admin = JSON.parse(localStorage.getItem('admin'));
                    if ((email === admin.email || email === admin.username) && password === admin.password) {
                    } else {
                        hideLoading();
                        showNotification('loginNotification', 'System is under maintenance. Please try again later.', 'warning', 180000);
                        return;
                    }
                }
                
                const admin = JSON.parse(localStorage.getItem('admin'));
                if ((email === admin.email || email === admin.username) && password === admin.password) {
                    loginUser(admin);
                    hideLoading();
                    showToast('Login Successful', 'Welcome back, Administrator!', 'success');
                    return;
                }
                
                const users = JSON.parse(localStorage.getItem('users'));
                const user = users.find(u => u.email === email || u.username === email);
                
                if (user) {
                    const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests'));
                    const approvedRequest = passwordRequests.find(req => 
                        req.userEmail === user.email && req.status === 'approved'
                    );
                    
                    if (approvedRequest) {
                        resetRequestEmail = user.email;
                        hideLoading();
                        showPage('verificationPage');
                        showNotification('verificationNotification', 'Please verify your identity to complete password reset.', 'info', 180000);
                        return;
                    }
                    
                    if (user.status !== 'active') {
                        let message = 'Account is not active.';
                        if (user.status === 'pending') {
                            message = 'Account pending approval. Please wait for admin approval.';
                        } else if (user.status === 'suspended') {
                            message = 'Account suspended. Please contact admin.';
                        } else if (user.status === 'banned') {
                            message = 'Account banned. Please contact admin.';
                        }
                        
                        hideLoading();
                        showNotification('loginNotification', message, 'warning', 180000);
                        return;
                    }
                    
                    if (user.password === password) {
                        loginAttempts[attemptKey].count = 0;
                        loginAttempts[attemptKey].lastAttempt = new Date().toISOString();
                        localStorage.setItem('loginAttempts', JSON.stringify(loginAttempts));
                        
                        loginUser(user);
                        hideLoading();
                        showToast('Login Successful', `Welcome back, ${user.username}!`, 'success');
                    } else {
                        loginAttempts[attemptKey].count++;
                        loginAttempts[attemptKey].lastAttempt = new Date().toISOString();
                        localStorage.setItem('loginAttempts', JSON.stringify(loginAttempts));
                        
                        hideLoading();
                        showNotification('loginNotification', `Invalid password. ${MAX_LOGIN_ATTEMPTS - loginAttempts[attemptKey].count} attempts remaining.`, 'error');
                    }
                } else {
                    hideLoading();
                    showNotification('loginNotification', 'User not found.', 'error');
                }
            } catch (error) {
                hideLoading();
                showToast('Login Error', 'An error occurred during login.', 'error');
            }
        }

        // Login User
        function loginUser(user) {
            currentUser = user;
            
            user.lastLogin = new Date().toISOString();
            user.lastSeen = new Date().toISOString();
            user.online = true;
            
            if (!user.loginHistory) {
                user.loginHistory = [];
            }
            user.loginHistory.push({
                timestamp: new Date().toISOString(),
                action: 'login'
            });
            
            if (user.role === 'admin') {
                localStorage.setItem('admin', JSON.stringify(user));
            } else {
                const users = JSON.parse(localStorage.getItem('users'));
                const userIndex = users.findIndex(u => u.id === user.id);
                if (userIndex !== -1) {
                    users[userIndex] = user;
                    localStorage.setItem('users', JSON.stringify(users));
                }
            }
            
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            logActivity(user.role, user.id, 'User logged in');
            
            if (soundEnabled) {
                playSound('login');
            }
            
            if (user.role === 'admin') {
                document.getElementById('adminHomepage').style.display = 'block';
                document.getElementById('loginPage').style.display = 'none';
                loadAdminPage('dashboard');
                updateAdminUI();
            } else {
                document.getElementById('userHomepage').style.display = 'block';
                document.getElementById('loginPage').style.display = 'none';
                loadUserPage('userDashboard');
                updateUserUI();
            }
            
            loadAvatar();
            
            if (user.role === 'admin') {
                startScheduleTimer();
            }
        }

        // Update Admin UI
        function updateAdminUI() {
            document.getElementById('adminName').textContent = currentUser.fullName;
            document.getElementById('adminAvatarText').textContent = currentUser.avatar;
            
            loadAvatar();
            
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            const maintenanceToggle = document.getElementById('maintenanceToggle');
            const maintenanceStatus = document.getElementById('maintenanceStatus');
            if (maintenanceToggle && maintenanceStatus) {
                maintenanceToggle.checked = settings.maintenance;
                maintenanceStatus.textContent = settings.maintenance ? 'ON' : 'OFF';
            }
            
            updateSignupStatusBadge();
        }

        // Update User UI
        function updateUserUI() {
            document.getElementById('userName').textContent = currentUser.fullName;
            document.getElementById('userAvatarText').textContent = currentUser.avatar;
            document.getElementById('userStatus').textContent = currentUser.status;
            
            loadAvatar();
            
            const onlineStatus = currentUser.online ? 'Online' : 'Offline';
            document.getElementById('userStatus').textContent += `  ${onlineStatus}`;
        }

        // Load Avatar
        function loadAvatar() {
            const avatars = JSON.parse(localStorage.getItem('avatars')) || {};
            const avatarKey = currentUser.id;
            const avatarContainer = currentUser.role === 'admin' ? 
                document.getElementById('adminAvatar') : 
                document.getElementById('userAvatar');
            const avatarText = currentUser.role === 'admin' ?
                document.getElementById('adminAvatarText') :
                document.getElementById('userAvatarText');
            
            if (avatars[avatarKey]) {
                avatarText.style.display = 'none';
                if (!avatarContainer.querySelector('img')) {
                    const img = document.createElement('img');
                    img.className = 'avatar-img';
                    img.src = avatars[avatarKey];
                    avatarContainer.appendChild(img);
                } else {
                    avatarContainer.querySelector('img').src = avatars[avatarKey];
                }
            } else {
                avatarText.style.display = 'flex';
                const img = avatarContainer.querySelector('img');
                if (img) {
                    img.remove();
                }
            }
        }

        // Open Avatar Upload
        function openAvatarUpload() {
            showModal('avatarUploadModal');
        }

        // Preview Avatar
        function previewAvatar(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewImg = document.getElementById('avatarPreviewImg');
                    previewImg.src = e.target.result;
                    previewImg.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // Save Avatar
        function saveAvatar() {
            const fileInput = document.getElementById('avatarUploadInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showToast('Error', 'Please select an image first.', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const avatars = JSON.parse(localStorage.getItem('avatars')) || {};
                avatars[currentUser.id] = e.target.result;
                localStorage.setItem('avatars', JSON.stringify(avatars));
                
                loadAvatar();
                
                closeModal('avatarUploadModal');
                showToast('Success', 'Avatar updated successfully.', 'success');
            };
            reader.readAsDataURL(file);
        }

        // Signup Function
        async function signup() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            if (!settings.allowSignups) {
                if (settings.signupScheduleEnabled) {
                    const now = new Date();
                    const scheduleStart = settings.signupScheduleStart ? new Date(settings.signupScheduleStart) : null;
                    const scheduleEnd = settings.signupScheduleEnd ? new Date(settings.signupScheduleEnd) : null;
                    
                    if (scheduleStart && now < scheduleStart) {
                        showToast('Signups Not Open', 'Signups will open at the scheduled time. Please check the timer.', 'warning');
                        return;
                    } else if (scheduleEnd && now > scheduleEnd) {
                        showToast('Signups Closed', 'The signup schedule has ended. Signups are now closed.', 'error');
                        return;
                    }
                } else {
                    showToast('Signups Disabled', 'New user registrations are currently disabled. Please try again later.', 'error');
                    return;
                }
            }
            
            showLoading('Creating account...');
            
            try {
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                const username = document.getElementById('signupUsername').value;
                const fullName = document.getElementById('signupFullName').value;
                const nickname = document.getElementById('signupNickname').value;
                const email = document.getElementById('signupEmail').value;
                const phone = document.getElementById('signupPhone').value;
                const country = document.getElementById('signupCountry').value;
                const countryCode = document.getElementById('signupCountryCode').value;
                const dob = document.getElementById('signupDob').value;
                const gender = document.getElementById('signupGender').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;
                
                if (password !== confirmPassword) {
                    hideLoading();
                    showNotification('signupNotification', 'Passwords do not match.', 'error', 180000);
                    return;
                }
                
                const users = JSON.parse(localStorage.getItem('users'));
                const existingUser = users.find(u => u.email === email || u.username === username);
                
                if (existingUser) {
                    hideLoading();
                    showNotification('signupNotification', 'User already exists.', 'error', 180000);
                    return;
                }
                
                const newUser = {
                    id: 'user-' + Date.now(),
                    username,
                    fullName,
                    nickname,
                    email,
                    phone,
                    country,
                    countryCode,
                    dob,
                    gender,
                    password,
                    role: 'user',
                    status: 'pending',
                    avatar: username.charAt(0).toUpperCase(),
                    createdAt: new Date().toISOString(),
                    lastLogin: null,
                    lastLogout: null,
                    lastSeen: new Date().toISOString(),
                    online: false,
                    loginHistory: []
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                logActivity('system', 'signup', `New user registered: ${username}`);
                
                createNotification('admin', 'New User Registration', 
                    `User ${username} (${email}) has registered and is pending approval.`, 'info');
                
                hideLoading();
                showNotification('signupNotification', 'Your account has been created and is pending admin approval.', 'success', 180000);
                
                setTimeout(() => {
                    document.getElementById('signupForm').reset();
                    showPage('loginPage');
                }, 3000);
            } catch (error) {
                hideLoading();
                showToast('Registration Error', 'An error occurred during registration.', 'error');
            }
        }

        // Request Password Reset
        function requestPasswordReset() {
            showLoading('Processing request...');
            
            setTimeout(() => {
                const email = document.getElementById('forgotEmail').value;
                const users = JSON.parse(localStorage.getItem('users'));
                const user = users.find(u => u.email === email);
                
                if (!user) {
                    hideLoading();
                    showNotification('forgotNotification', 'No account found with this email.', 'error', 180000);
                    return;
                }
                
                const settings = JSON.parse(localStorage.getItem('systemSettings'));
                if (!settings.allowPasswordReset) {
                    hideLoading();
                    showNotification('forgotNotification', 'Password reset is currently disabled. Please contact admin.', 'error', 180000);
                    return;
                }
                
                const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests')) || [];
                const existingRequest = passwordRequests.find(req => req.userEmail === email && req.status === 'pending');
                
                if (!existingRequest) {
                    const newRequest = {
                        id: 'pwd-req-' + Date.now(),
                        userEmail: email,
                        userName: user.username,
                        userFullName: user.fullName,
                        timestamp: new Date().toISOString(),
                        status: 'pending',
                        adminAction: null,
                        adminActionTime: null,
                        generatedPassword: null
                    };
                    
                    passwordRequests.push(newRequest);
                    localStorage.setItem('passwordRequests', JSON.stringify(passwordRequests));
                    
                    createNotification('admin', 'Password Reset Request', 
                        `User ${user.username} (${email}) has requested a password reset.`, 'warning');
                }
                
                hideLoading();
                showNotification('forgotNotification', 'Password reset request sent to admin. You will be notified when approved.', 'success', 180000);
                
                document.getElementById('forgotEmail').value = '';
            }, 1000);
        }

        // Verify Identity
        function verifyIdentity() {
            showLoading('Verifying identity...');
            
            setTimeout(() => {
                const nickname = document.getElementById('verifyNickname').value;
                const dob = document.getElementById('verifyDob').value;
                const phone = document.getElementById('verifyPhone').value;
                const countryCode = document.getElementById('verifyCountryCode').value;
                
                const users = JSON.parse(localStorage.getItem('users'));
                const user = users.find(u => u.email === resetRequestEmail);
                
                if (!user) {
                    hideLoading();
                    showNotification('verificationNotification', 'User not found.', 'error', 180000);
                    return;
                }
                
                verificationAttempts++;
                
                if (verificationAttempts > 3) {
                    hideLoading();
                    showNotification('verificationNotification', 'Too many verification attempts. Your account has been blocked.', 'error', 180000);
                    
                    user.status = 'banned';
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    logActivity('system', 'verification', `User ${user.username} blocked after 3 failed verification attempts`);
                    
                    createNotification('admin', 'Account Blocked', 
                        `User ${user.username} has been blocked after 3 failed verification attempts.`, 'danger');
                    
                    return;
                }
                
                if (user.nickname === nickname && 
                    user.dob === dob && 
                    user.phone === phone && 
                    user.countryCode === countryCode) {
                    
                    hideLoading();
                    showPage('passwordUpdatePage');
                    
                    const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests'));
                    const approvedRequest = passwordRequests.find(req => 
                        req.userEmail === user.email && req.status === 'approved'
                    );
                    
                    if (approvedRequest && approvedRequest.generatedPassword) {
                        document.getElementById('autoGeneratedPassword').style.display = 'block';
                        document.getElementById('generatedPasswordText').textContent = approvedRequest.generatedPassword;
                    }
                    
                    verificationAttempts = 0;
                } else {
                    hideLoading();
                    showNotification('verificationNotification', 
                        `Verification failed. ${3 - verificationAttempts} attempts remaining.`, 'error', 180000);
                }
            }, 1000);
        }

        // Update Password
        function updatePassword() {
            showLoading('Updating password...');
            
            setTimeout(() => {
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmNewPassword').value;
                
                if (newPassword !== confirmPassword) {
                    hideLoading();
                    showNotification('passwordUpdateNotification', 'Passwords do not match.', 'error', 180000);
                    return;
                }
                
                const users = JSON.parse(localStorage.getItem('users'));
                const userIndex = users.findIndex(u => u.email === resetRequestEmail);
                
                if (userIndex !== -1) {
                    users[userIndex].password = newPassword;
                    users[userIndex].lastPasswordChange = new Date().toISOString();
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests'));
                    const requestIndex = passwordRequests.findIndex(req => 
                        req.userEmail === resetRequestEmail && req.status === 'approved'
                    );
                    
                    if (requestIndex !== -1) {
                        passwordRequests[requestIndex].status = 'completed';
                        passwordRequests[requestIndex].completedAt = new Date().toISOString();
                        localStorage.setItem('passwordRequests', JSON.stringify(passwordRequests));
                    }
                    
                    logActivity('user', users[userIndex].id, 'Password changed successfully');
                    
                    createNotification('admin', 'Password Changed', 
                        `User ${users[userIndex].username} has successfully changed their password.`, 'success');
                    
                    createNotification(users[userIndex].id, 'Password Changed', 
                        'Your password has been changed successfully.', 'success');
                    
                    hideLoading();
                    showToast('Password Updated', 'Your password has been updated successfully.', 'success');
                    
                    setTimeout(() => {
                        showPage('loginPage');
                        resetRequestEmail = null;
                    }, 2000);
                } else {
                    hideLoading();
                    showNotification('passwordUpdateNotification', 'User not found.', 'error', 180000);
                }
            }, 1000);
        }

        // Use Generated Password
        function useGeneratedPassword() {
            const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests'));
            const approvedRequest = passwordRequests.find(req => 
                req.userEmail === resetRequestEmail && req.status === 'approved'
            );
            
            if (approvedRequest && approvedRequest.generatedPassword) {
                document.getElementById('newPassword').value = approvedRequest.generatedPassword;
                document.getElementById('confirmNewPassword').value = approvedRequest.generatedPassword;
                updatePassword();
            }
        }

        // Load Admin Page
        function loadAdminPage(page) {
            currentPage = page;
            const contentArea = document.getElementById('adminContent');
            
            contentArea.innerHTML = `
                <div style="margin-bottom:20px;">
                    <div class="skeleton skeleton-text" style="width:200px; height:30px;"></div>
                </div>
                <div class="dashboard-cards">
                    ${Array(4).fill().map(() => `
                        <div class="card">
                            <div class="card-header">
                                <div class="skeleton skeleton-text" style="width:100px;"></div>
                                <div class="skeleton" style="width:24px; height:24px;"></div>
                            </div>
                            <div class="skeleton skeleton-text" style="width:80px; height:32px;"></div>
                            <div class="skeleton skeleton-text" style="width:120px;"></div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            setTimeout(() => {
                switch(page) {
                    case 'dashboard':
                        loadAdminDashboard(contentArea);
                        break;
                    case 'userManagement':
                        loadUserManagement(contentArea);
                        break;
                    case 'notifications':
                        loadAdminNotifications(contentArea);
                        break;
                    case 'passwordRequests':
                        loadPasswordRequests(contentArea);
                        break;
                    case 'systemReset':
                        loadSystemReset(contentArea);
                        break;
                    case 'systemSettings':
                        loadSystemSettingsPage(contentArea);
                        break;
                    case 'adminProfile':
                        loadAdminProfile(contentArea);
                        break;
                    case 'activityLogs':
                        loadActivityLogs(contentArea);
                        break;
                    case 'backupRestore':
                        loadBackupRestore(contentArea);
                        break;
                }
            }, 500);
        }

        // Load Admin Dashboard
        function loadAdminDashboard(container) {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const activities = JSON.parse(localStorage.getItem('activities')) || [];
            const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests')) || [];
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            
            const totalUsers = users.length;
            const activeUsers = users.filter(u => u.status === 'active').length;
            const pendingUsers = users.filter(u => u.status === 'pending').length;
            const suspendedUsers = users.filter(u => u.status === 'suspended').length;
            const pendingPasswordRequests = passwordRequests.filter(r => r.status === 'pending').length;
            
            let scheduleTimerHTML = '';
            if (settings.signupScheduleEnabled && (settings.signupScheduleStart || settings.signupScheduleEnd)) {
                scheduleTimerHTML = `
                    <div class="form-section">
                        <h3 class="section-title">Signup Schedule Timer</h3>
                        <div class="schedule-timer" id="adminScheduleTimer">
                            <div class="schedule-timer-header">
                                <div class="schedule-timer-title">Signup Schedule</div>
                                <div class="schedule-timer-status" id="adminScheduleStatus">Active</div>
                            </div>
                            <div class="schedule-timer-time" id="adminScheduleTime">00:00:00</div>
                            <div class="schedule-timer-message" id="adminScheduleMessage">Signups will close in</div>
                        </div>
                    </div>
                `;
                
                setTimeout(() => updateAdminScheduleTimer(), 100);
            }
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Admin Dashboard</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${totalUsers}</div>
                        <div class="stat-label">Total Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${activeUsers}</div>
                        <div class="stat-label">Active Users</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${pendingUsers}</div>
                        <div class="stat-label">Pending Approval</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${suspendedUsers}</div>
                        <div class="stat-label">Suspended</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${pendingPasswordRequests}</div>
                        <div class="stat-label">Password Requests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${settings.allowSignups ? 'Enabled' : 'Disabled'}</div>
                        <div class="stat-label">Signup Status</div>
                    </div>
                </div>
                
                ${scheduleTimerHTML}
                
                <div class="form-section">
                    <h3 class="section-title">Quick Actions</h3>
                    <div style="display:flex; gap:15px; flex-wrap:wrap;">
                        <button class="btn btn-success" onclick="loadAdminPage('userManagement')">
                            <i class="fas fa-users"></i> Manage Users
                        </button>
                        <button class="btn btn-warning" onclick="loadAdminPage('passwordRequests')">
                            <i class="fas fa-key"></i> Password Requests
                        </button>
                        <button class="btn ${settings.allowSignups ? 'btn-danger' : 'btn-success'}" onclick="toggleSignupStatus()">
                            <i class="fas ${settings.allowSignups ? 'fa-user-slash' : 'fa-user-plus'}"></i> ${settings.allowSignups ? 'Disable' : 'Enable'} Signups
                        </button>
                        <button class="btn btn-info" onclick="loadAdminPage('systemSettings')">
                            <i class="fas fa-clock"></i> Schedule Settings
                        </button>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Recent Activities</h3>
                    <div id="recentActivities" class="activity-timeline">
                    </div>
                </div>
            `;
            
            loadRecentActivities();
        }

        // Toggle Signup Status
        function toggleSignupStatus() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            settings.allowSignups = !settings.allowSignups;
            
            if (!settings.allowSignups) {
                showToast('Signups Disabled', 'New user registrations have been disabled.', 'warning');
            } else {
                showToast('Signups Enabled', 'New user registrations have been enabled.', 'success');
            }
            
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            updateSignupStatusBadge();
            
            loadAdminPage('dashboard');
        }

        // Load Recent Activities
        function loadRecentActivities() {
            const activities = JSON.parse(localStorage.getItem('activities')) || [];
            const container = document.getElementById('recentActivities');
            const recentActivities = activities.slice(-10).reverse();
            
            if (recentActivities.length === 0) {
                container.innerHTML = '<p>No recent activities.</p>';
                return;
            }
            
            container.innerHTML = recentActivities.map(activity => `
                <div class="activity-item">
                    <div class="activity-time">${formatDate(activity.timestamp)}</div>
                    <div class="activity-text">${activity.action}</div>
                </div>
            `).join('');
        }

        // Load User Management
        function loadUserManagement(container) {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const pendingUsers = users.filter(u => u.status === 'pending');
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">User Management</h2>
                
                ${pendingUsers.length > 0 ? `
                    <div class="form-section">
                        <h3 class="section-title">Pending Approvals (${pendingUsers.length})</h3>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Full Name</th>
                                        <th>Email</th>
                                        <th>Country</th>
                                        <th>Registered</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="pendingUsersTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                ` : ''}
                
                <div class="form-section">
                    <h3 class="section-title">All Users (${users.length})</h3>
                    <div style="margin-bottom:15px;">
                        <input type="text" id="userSearchInput" placeholder="Search users..." class="form-control" style="width:300px; display:inline-block;">
                        <button class="btn" onclick="searchUsers()" style="margin-left:10px;">Search</button>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Full Name</th>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Last Login</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            loadPendingUsers();
            loadAllUsers();
        }

        // Load Pending Users
        function loadPendingUsers() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const pendingUsers = users.filter(u => u.status === 'pending');
            const container = document.getElementById('pendingUsersTable');
            
            if (pendingUsers.length === 0) {
                const pendingSection = document.querySelector('.form-section:nth-child(2)');
                if (pendingSection) pendingSection.style.display = 'none';
                return;
            }
            
            container.innerHTML = pendingUsers.map(user => `
                <tr>
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>${user.email}</td>
                    <td>${user.country}</td>
                    <td>${formatDate(user.createdAt)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="action-btn edit" title="Approve" onclick="approveUser('${user.id}')">
                                <i class="fas fa-check"></i>
                            </button>
                            <button class="action-btn delete" title="Reject" onclick="rejectUser('${user.id}')">
                                <i class="fas fa-times"></i>
                            </button>
                            <button class="action-btn" title="View Details" onclick="viewUserDetails('${user.id}')" style="background:rgba(114,9,183,0.1); color:var(--info-color);">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            const pendingCount = pendingUsers.length;
            document.getElementById('pendingSignupCount').textContent = pendingCount;
        }

        // Load All Users
        function loadAllUsers() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const container = document.getElementById('usersTable');
            
            container.innerHTML = users.map(user => `
                <tr>
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="status-badge ${getStatusClass(user.status)}">${user.status}</span>
                    </td>
                    <td>${user.lastLogin ? formatDate(user.lastLogin) : 'Never'}</td>
                    <td>
                        <div class="action-buttons">
                            ${user.status === 'active' ? `
                                <button class="action-btn" title="Suspend" onclick="suspendUser('${user.id}')" style="background:rgba(255,193,7,0.1); color:#ffc107;">
                                    <i class="fas fa-pause"></i>
                                </button>
                                <button class="action-btn delete" title="Deactivate" onclick="deactivateUser('${user.id}')">
                                    <i class="fas fa-user-slash"></i>
                                </button>
                            ` : user.status === 'suspended' ? `
                                <button class="action-btn edit" title="Unsuspend" onclick="unsuspendUser('${user.id}')">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="action-btn delete" title="Ban" onclick="banUser('${user.id}')">
                                    <i class="fas fa-ban"></i>
                                </button>
                            ` : user.status === 'inactive' ? `
                                <button class="action-btn edit" title="Activate" onclick="activateUser('${user.id}')">
                                    <i class="fas fa-check"></i>
                                </button>
                            ` : ''}
                            <button class="action-btn" title="Reset Password" onclick="adminResetPassword('${user.id}')" style="background:rgba(67,97,238,0.1); color:var(--primary-color);">
                                <i class="fas fa-key"></i>
                            </button>
                            <button class="action-btn delete" title="Delete" onclick="deleteUser('${user.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Get Status Class
        function getStatusClass(status) {
            switch(status) {
                case 'active': return 'status-active';
                case 'pending': return 'status-pending';
                case 'suspended': return 'status-suspended';
                case 'inactive': return 'status-inactive';
                case 'banned': return 'status-banned';
                default: return 'status-inactive';
            }
        }

        // Search Users
        function searchUsers() {
            const searchTerm = document.getElementById('userSearchInput').value.toLowerCase();
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const filteredUsers = users.filter(user => 
                user.username.toLowerCase().includes(searchTerm) ||
                user.fullName.toLowerCase().includes(searchTerm) ||
                user.email.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('usersTable');
            container.innerHTML = filteredUsers.map(user => `
                <tr>
                    <td>${user.username}</td>
                    <td>${user.fullName}</td>
                    <td>${user.email}</td>
                    <td>
                        <span class="status-badge ${getStatusClass(user.status)}">${user.status}</span>
                    </td>
                    <td>${user.lastLogin ? formatDate(user.lastLogin) : 'Never'}</td>
                    <td>
                        <div class="action-buttons">
                            ${user.status === 'active' ? `
                                <button class="action-btn" title="Suspend" onclick="suspendUser('${user.id}')" style="background:rgba(255,193,7,0.1); color:#ffc107;">
                                    <i class="fas fa-pause"></i>
                                </button>
                                <button class="action-btn delete" title="Deactivate" onclick="deactivateUser('${user.id}')">
                                    <i class="fas fa-user-slash"></i>
                                </button>
                            ` : user.status === 'suspended' ? `
                                <button class="action-btn edit" title="Unsuspend" onclick="unsuspendUser('${user.id}')">
                                    <i class="fas fa-play"></i>
                                </button>
                                <button class="action-btn delete" title="Ban" onclick="banUser('${user.id}')">
                                    <i class="fas fa-ban"></i>
                                </button>
                            ` : user.status === 'inactive' ? `
                                <button class="action-btn edit" title="Activate" onclick="activateUser('${user.id}')">
                                    <i class="fas fa-check"></i>
                                </button>
                            ` : ''}
                            <button class="action-btn" title="Reset Password" onclick="adminResetPassword('${user.id}')" style="background:rgba(67,97,238,0.1); color:var(--primary-color);">
                                <i class="fas fa-key"></i>
                            </button>
                            <button class="action-btn delete" title="Delete" onclick="deleteUser('${user.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Approve User
        function approveUser(userId) {
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                users[userIndex].status = 'active';
                localStorage.setItem('users', JSON.stringify(users));
                
                logActivity('admin', currentUser.id, `Approved user: ${users[userIndex].username}`);
                
                createNotification(userId, 'Account Approved', 
                    'Your account has been approved by admin. You can now login.', 'success');
                
                showToast('User Approved', 'User account has been approved.', 'success');
                loadPendingUsers();
                loadAllUsers();
            }
        }

        // Reject User
        function rejectUser(userId) {
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                const username = users[userIndex].username;
                users.splice(userIndex, 1);
                localStorage.setItem('users', JSON.stringify(users));
                
                logActivity('admin', currentUser.id, `Rejected user: ${username}`);
                
                showToast('User Rejected', 'User account has been rejected and removed.', 'success');
                loadPendingUsers();
                loadAllUsers();
            }
        }

        // Activate User
        function activateUser(userId) {
            updateUserStatus(userId, 'active', 'activated');
        }

        // Deactivate User
        function deactivateUser(userId) {
            updateUserStatus(userId, 'inactive', 'deactivated');
        }

        // Suspend User
        function suspendUser(userId) {
            updateUserStatus(userId, 'suspended', 'suspended');
        }

        // Unsuspend User
        function unsuspendUser(userId) {
            updateUserStatus(userId, 'active', 'unsuspended');
        }

        // Ban User
        function banUser(userId) {
            updateUserStatus(userId, 'banned', 'banned');
        }

        // Update User Status
        function updateUserStatus(userId, status, action) {
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                const oldStatus = users[userIndex].status;
                users[userIndex].status = status;
                localStorage.setItem('users', JSON.stringify(users));
                
                logActivity('admin', currentUser.id, `${action} user: ${users[userIndex].username} (${oldStatus}  ${status})`);
                
                if (status !== 'active') {
                    createNotification(userId, `Account ${action}`, 
                        `Your account has been ${action} by admin.`, 'warning');
                }
                
                showToast(`User ${action}`, `User has been ${action}.`, 'success');
                loadAllUsers();
            }
        }

        // Admin Reset Password
        function adminResetPassword(userId) {
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.id === userId);
            
            if (userIndex !== -1) {
                const user = users[userIndex];
                
                const timestamp = Date.now().toString();
                const generatedPassword = timestamp.slice(-8);
                
                users[userIndex].password = generatedPassword;
                users[userIndex].lastPasswordChange = new Date().toISOString();
                localStorage.setItem('users', JSON.stringify(users));
                
                const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests')) || [];
                const existingRequestIndex = passwordRequests.findIndex(req => req.userEmail === user.email);
                
                if (existingRequestIndex !== -1) {
                    passwordRequests[existingRequestIndex].status = 'approved';
                    passwordRequests[existingRequestIndex].adminAction = 'password_reset';
                    passwordRequests[existingRequestIndex].adminActionTime = new Date().toISOString();
                    passwordRequests[existingRequestIndex].generatedPassword = generatedPassword;
                } else {
                    passwordRequests.push({
                        id: 'pwd-req-' + Date.now(),
                        userEmail: user.email,
                        userName: user.username,
                        userFullName: user.fullName,
                        timestamp: new Date().toISOString(),
                        status: 'approved',
                        adminAction: 'password_reset',
                        adminActionTime: new Date().toISOString(),
                        generatedPassword: generatedPassword
                    });
                }
                
                localStorage.setItem('passwordRequests', JSON.stringify(passwordRequests));
                
                logActivity('admin', currentUser.id, `Reset password for user: ${user.username}`);
                
                createNotification(userId, 'Password Reset', 
                    'Admin has reset your password. Please login and follow verification steps to set a new password.', 'info');
                
                showToast('Password Reset', `Password has been reset for ${user.username}. Generated password: ${generatedPassword}`, 'success');
            }
        }

        // Delete User
        function deleteUser(userId) {
            showConfirmation('Delete User', 'Are you sure you want to delete this user? This action cannot be undone.', () => {
                const users = JSON.parse(localStorage.getItem('users'));
                const userIndex = users.findIndex(u => u.id === userId);
                
                if (userIndex !== -1) {
                    const username = users[userIndex].username;
                    users.splice(userIndex, 1);
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    logActivity('admin', currentUser.id, `Deleted user: ${username}`);
                    
                    showToast('User Deleted', 'User has been deleted.', 'success');
                    loadAllUsers();
                }
            });
        }

        // View User Details
        function viewUserDetails(userId) {
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.id === userId);
            
            if (user) {
                showConfirmation('User Details', `
                    <strong>Username:</strong> ${user.username}<br>
                    <strong>Full Name:</strong> ${user.fullName}<br>
                    <strong>Email:</strong> ${user.email}<br>
                    <strong>Phone:</strong> ${user.countryCode} ${user.phone}<br>
                    <strong>Country:</strong> ${user.country}<br>
                    <strong>Date of Birth:</strong> ${user.dob}<br>
                    <strong>Gender:</strong> ${user.gender}<br>
                    <strong>Status:</strong> ${user.status}<br>
                    <strong>Registered:</strong> ${formatDate(user.createdAt)}<br>
                    <strong>Last Login:</strong> ${user.lastLogin ? formatDate(user.lastLogin) : 'Never'}<br>
                    <strong>Login Count:</strong> ${user.loginHistory ? user.loginHistory.filter(h => h.action === 'login').length : 0}
                `, null, true);
            }
        }

        // Load Admin Notifications
        function loadAdminNotifications(container) {
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            const adminNotifications = notifications.filter(n => n.recipient === 'admin').sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Notifications</h2>
                
                <div class="form-section">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h3 class="section-title">All Notifications</h3>
                        <button class="btn" onclick="markAllNotificationsAsRead()">
                            <i class="fas fa-check-double"></i> Mark All as Read
                        </button>
                    </div>
                    <div id="notificationsList">
                    </div>
                </div>
            `;
            
            loadNotificationsList(adminNotifications);
        }

        // Load Notifications List
        function loadNotificationsList(notifications) {
            const container = document.getElementById('notificationsList');
            
            if (notifications.length === 0) {
                container.innerHTML = '<p>No notifications.</p>';
                return;
            }
            
            container.innerHTML = notifications.map(notif => `
                <div class="friend-request-item" style="${notif.read ? 'opacity:0.7;' : ''}">
                    <div>
                        <div style="font-weight:600;">${notif.title}</div>
                        <div style="font-size:14px; margin:5px 0;">${notif.message}</div>
                        <div style="font-size:12px; color:#666;">${formatDate(notif.timestamp, true)}</div>
                    </div>
                    <div class="friend-request-actions">
                        ${!notif.read ? `
                            <button class="btn btn-success" onclick="markNotificationAsRead('${notif.id}')" style="padding:5px 10px; font-size:12px;">
                                Mark Read
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Mark Notification as Read
        function markNotificationAsRead(notificationId) {
            const notifications = JSON.parse(localStorage.getItem('notifications'));
            const notifIndex = notifications.findIndex(n => n.id === notificationId);
            
            if (notifIndex !== -1) {
                notifications[notifIndex].read = true;
                localStorage.setItem('notifications', JSON.stringify(notifications));
                
                if (currentUser.role === 'admin') {
                    loadAdminPage('notifications');
                } else {
                    loadUserPage('userNotifications');
                }
            }
        }

        // Mark All Notifications as Read
        function markAllNotificationsAsRead() {
            const notifications = JSON.parse(localStorage.getItem('notifications'));
            const recipient = currentUser.role === 'admin' ? 'admin' : currentUser.id;
            const userNotifications = notifications.filter(n => n.recipient === recipient);
            
            userNotifications.forEach(notif => {
                notif.read = true;
            });
            
            localStorage.setItem('notifications', JSON.stringify(notifications));
            
            if (currentUser.role === 'admin') {
                loadAdminPage('notifications');
            } else {
                loadUserPage('userNotifications');
            }
            
            showToast('Notifications', 'All notifications marked as read.', 'success');
        }

        // Load Password Requests
        function loadPasswordRequests(container) {
            const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests')) || [];
            const pendingRequests = passwordRequests.filter(r => r.status === 'pending').sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Password Reset Requests</h2>
                
                ${pendingRequests.length > 0 ? `
                    <div class="form-section">
                        <h3 class="section-title">Pending Requests (${pendingRequests.length})</h3>
                        <div id="pendingPasswordRequests">
                        </div>
                    </div>
                ` : ''}
                
                <div class="form-section">
                    <h3 class="section-title">Request History</h3>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>User</th>
                                    <th>Email</th>
                                    <th>Request Time</th>
                                    <th>Status</th>
                                    <th>Admin Action</th>
                                    <th>Action Time</th>
                                </tr>
                            </thead>
                            <tbody id="passwordRequestsHistory">
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            loadPendingPasswordRequests();
            loadPasswordRequestsHistory();
        }

        // Load Pending Password Requests
        function loadPendingPasswordRequests() {
            const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests')) || [];
            const pendingRequests = passwordRequests.filter(r => r.status === 'pending');
            const container = document.getElementById('pendingPasswordRequests');
            
            if (pendingRequests.length === 0) {
                const pendingSection = document.querySelector('.form-section:nth-child(2)');
                if (pendingSection) pendingSection.style.display = 'none';
                return;
            }
            
            container.innerHTML = pendingRequests.map(req => `
                <div class="friend-request-item">
                    <div>
                        <div style="font-weight:600;">${req.userFullName} (@${req.userName})</div>
                        <div style="font-size:14px; margin:5px 0;">${req.userEmail}</div>
                        <div style="font-size:12px; color:#666;">Requested: ${formatDate(req.timestamp, true)}</div>
                    </div>
                    <div class="friend-request-actions">
                        <button class="btn btn-success" onclick="approvePasswordRequest('${req.id}')">
                            Approve & Generate Password
                        </button>
                        <button class="btn btn-danger" onclick="rejectPasswordRequest('${req.id}')">
                            Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Load Password Requests History
        function loadPasswordRequestsHistory() {
            const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests')) || [];
            const container = document.getElementById('passwordRequestsHistory');
            
            container.innerHTML = passwordRequests.slice().reverse().map(req => `
                <tr>
                    <td>${req.userName}</td>
                    <td>${req.userEmail}</td>
                    <td>${formatDate(req.timestamp)}</td>
                    <td>
                        <span class="status-badge ${req.status === 'approved' ? 'status-active' : req.status === 'rejected' ? 'status-suspended' : 'status-pending'}">
                            ${req.status}
                        </span>
                    </td>
                    <td>${req.adminAction || '-'}</td>
                    <td>${req.adminActionTime ? formatDate(req.adminActionTime) : '-'}</td>
                </tr>
            `).join('');
        }

        // Approve Password Request
        function approvePasswordRequest(requestId) {
            const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests'));
            const requestIndex = passwordRequests.findIndex(r => r.id === requestId);
            
            if (requestIndex !== -1) {
                const req = passwordRequests[requestIndex];
                
                const timestamp = Date.now().toString();
                const generatedPassword = timestamp.slice(-8);
                
                passwordRequests[requestIndex].status = 'approved';
                passwordRequests[requestIndex].adminAction = 'password_generated';
                passwordRequests[requestIndex].adminActionTime = new Date().toISOString();
                passwordRequests[requestIndex].generatedPassword = generatedPassword;
                
                localStorage.setItem('passwordRequests', JSON.stringify(passwordRequests));
                
                createNotificationByEmail(req.userEmail, 'Password Reset Approved', 
                    `Your password reset request has been approved. Please login with your email and follow verification steps. Generated password: ${generatedPassword}`, 'success');
                
                logActivity('admin', currentUser.id, `Approved password reset for ${req.userName}`);
                
                showToast('Request Approved', `Password reset approved for ${req.userName}. Generated password: ${generatedPassword}`, 'success');
                loadPendingPasswordRequests();
                loadPasswordRequestsHistory();
            }
        }

        // Reject Password Request
        function rejectPasswordRequest(requestId) {
            const passwordRequests = JSON.parse(localStorage.getItem('passwordRequests'));
            const requestIndex = passwordRequests.findIndex(r => r.id === requestId);
            
            if (requestIndex !== -1) {
                const req = passwordRequests[requestIndex];
                passwordRequests[requestIndex].status = 'rejected';
                passwordRequests[requestIndex].adminAction = 'request_rejected';
                passwordRequests[requestIndex].adminActionTime = new Date().toISOString();
                
                localStorage.setItem('passwordRequests', JSON.stringify(passwordRequests));
                
                createNotificationByEmail(req.userEmail, 'Password Reset Rejected', 
                    'Your password reset request has been rejected by admin. Please contact support if you believe this is an error.', 'warning');
                
                logActivity('admin', currentUser.id, `Rejected password reset for ${req.userName}`);
                
                showToast('Request Rejected', `Password reset rejected for ${req.userName}.`, 'success');
                loadPendingPasswordRequests();
                loadPasswordRequestsHistory();
            }
        }

        // Create Notification by Email
        function createNotificationByEmail(email, title, message, type) {
            const users = JSON.parse(localStorage.getItem('users'));
            const user = users.find(u => u.email === email);
            
            if (user) {
                createNotification(user.id, title, message, type);
            }
        }

        // Load System Reset
        function loadSystemReset(container) {
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">System Reset</h2>
                
                <div class="form-section">
                    <h3 class="section-title" style="color:var(--warning-color);">Reset Options</h3>
                    <p style="margin-bottom:15px; color:#666;">Warning: These actions are irreversible. Please proceed with caution.</p>
                    
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">
                        <div class="card">
                            <h4 style="margin-bottom:10px;">Reset User System</h4>
                            <p style="color:#666; margin-bottom:15px;">Reset all user data including profiles and activities.</p>
                            <button class="btn btn-warning btn-block" onclick="resetUserSystem()">Reset User System</button>
                        </div>
                        
                        <div class="card">
                            <h4 style="margin-bottom:10px;">Reset Admin System</h4>
                            <p style="color:#666; margin-bottom:15px;">Reset admin data and settings to default.</p>
                            <button class="btn btn-warning btn-block" onclick="resetAdminSystem()">Reset Admin System</button>
                        </div>
                        
                        <div class="card">
                            <h4 style="margin-bottom:10px;">Reset Entire System</h4>
                            <p style="color:#666; margin-bottom:15px;">Reset everything to factory defaults. This will delete all data.</p>
                            <button class="btn btn-danger btn-block" onclick="resetEntireSystem()">Reset Entire System</button>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">User Details Reset</h3>
                    <div class="form-group">
                        <label class="form-label">Select User</label>
                        <select id="userSelect" class="form-control">
                            <option value="">Select a user</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Reset Options</label>
                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                            <button class="btn" onclick="resetUserProfile()">Reset Profile</button>
                            <button class="btn" onclick="resetUserActivity()">Reset Activity</button>
                        </div>
                    </div>
                </div>
            `;
            
            loadUserSelect();
        }

        // Load User Select
        function loadUserSelect() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const select = document.getElementById('userSelect');
            
            select.innerHTML = '<option value="">Select a user</option>' +
                users.map(user => `<option value="${user.id}">${user.username} (${user.email})</option>`).join('');
        }

        // Reset User System
        function resetUserSystem() {
            showConfirmation('Reset User System', 'Are you sure you want to reset the entire user system? This will delete all user data and activities. This action cannot be undone.', () => {
                localStorage.removeItem('users');
                localStorage.removeItem('activities');
                localStorage.removeItem('notifications');
                localStorage.removeItem('passwordRequests');
                localStorage.removeItem('userSettings');
                localStorage.removeItem('avatars');
                
                localStorage.setItem('users', JSON.stringify([]));
                localStorage.setItem('activities', JSON.stringify([]));
                localStorage.setItem('notifications', JSON.stringify([]));
                localStorage.setItem('passwordRequests', JSON.stringify([]));
                localStorage.setItem('userSettings', JSON.stringify({}));
                localStorage.setItem('avatars', JSON.stringify({}));
                
                logActivity('admin', currentUser.id, 'Reset entire user system');
                
                showToast('System Reset', 'User system has been reset to default.', 'success');
                loadAdminPage('systemReset');
            });
        }

        // Reset Admin System
        function resetAdminSystem() {
            showConfirmation('Reset Admin System', 'Are you sure you want to reset the admin system? This will reset admin settings to default. This action cannot be undone.', () => {
                createAdminUser();
                currentUser = JSON.parse(localStorage.getItem('admin'));
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                const defaultSettings = {
                    maintenance: false,
                    darkMode: false,
                    background: 'gradient-blue',
                    brightness: 100,
                    fontSize: 'medium',
                    language: 'en',
                    allowSignups: true,
                    allowPasswordReset: true,
                    signupScheduleEnabled: false,
                    signupScheduleStart: null,
                    signupScheduleEnd: null,
                    soundEnabled: true
                };
                localStorage.setItem('systemSettings', JSON.stringify(defaultSettings));
                
                logActivity('admin', currentUser.id, 'Reset admin system');
                
                showToast('System Reset', 'Admin system has been reset to default.', 'success');
                loadSystemSettings();
                updateAdminUI();
                loadAdminPage('systemReset');
            });
        }

        // Reset Entire System
        function resetEntireSystem() {
            showConfirmation('Reset Entire System', 'Are you sure you want to reset the entire system? This will delete ALL data and restore factory defaults. This action cannot be undone.', () => {
                localStorage.clear();
                
                initializeSystem();
                
                logout();
                
                showToast('System Reset', 'Entire system has been reset to factory defaults.', 'success');
            });
        }

        // Reset User Profile
        function resetUserProfile() {
            const userId = document.getElementById('userSelect').value;
            if (!userId) {
                showToast('Error', 'Please select a user first.', 'error');
                return;
            }
            
            showConfirmation('Reset User Profile', 'Are you sure you want to reset this user\'s profile? This will restore profile to default values.', () => {
                const users = JSON.parse(localStorage.getItem('users'));
                const userIndex = users.findIndex(u => u.id === userId);
                
                if (userIndex !== -1) {
                    const user = users[userIndex];
                    const originalUsername = user.username;
                    
                    users[userIndex] = {
                        ...users[userIndex],
                        fullName: 'User',
                        nickname: 'User',
                        phone: '',
                        country: '',
                        countryCode: '',
                        avatar: originalUsername.charAt(0).toUpperCase(),
                        status: 'active'
                    };
                    
                    localStorage.setItem('users', JSON.stringify(users));
                    
                    const avatars = JSON.parse(localStorage.getItem('avatars')) || {};
                    delete avatars[userId];
                    localStorage.setItem('avatars', JSON.stringify(avatars));
                    
                    logActivity('admin', currentUser.id, `Reset profile for user: ${originalUsername}`);
                    
                    showToast('Profile Reset', `User profile has been reset.`, 'success');
                }
            });
        }

        // Reset User Activity
        function resetUserActivity() {
            const userId = document.getElementById('userSelect').value;
            if (!userId) {
                showToast('Error', 'Please select a user first.', 'error');
                return;
            }
            
            showConfirmation('Reset User Activity', 'Are you sure you want to reset this user\'s activity log? This will delete all activity records for this user.', () => {
                const activities = JSON.parse(localStorage.getItem('activities')) || [];
                const filteredActivities = activities.filter(act => act.userId !== userId);
                
                localStorage.setItem('activities', JSON.stringify(filteredActivities));
                
                const users = JSON.parse(localStorage.getItem('users'));
                const userIndex = users.findIndex(u => u.id === userId);
                
                if (userIndex !== -1) {
                    users[userIndex].loginHistory = [];
                    localStorage.setItem('users', JSON.stringify(users));
                }
                
                const user = users.find(u => u.id === userId);
                logActivity('admin', currentUser.id, `Reset activity for user: ${user.username}`);
                
                showToast('Activity Reset', `User activity has been reset.`, 'success');
            });
        }

        // Load System Settings Page
        function loadSystemSettingsPage(container) {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">System Settings</h2>
                
                <div class="form-section">
                    <h3 class="section-title">Maintenance Mode</h3>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="settingsMaintenanceToggle" ${settings.maintenance ? 'checked' : ''}>
                            Enable Maintenance Mode
                        </label>
                        <p style="font-size:14px; color:#666; margin-top:5px;">When enabled, only admin can access the system.</p>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">User Management</h3>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="allowSignupsToggle" ${settings.allowSignups ? 'checked' : ''}>
                            Allow New Signups
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="allowPasswordResetToggle" ${settings.allowPasswordReset ? 'checked' : ''}>
                            Allow Password Reset Requests
                        </label>
                    </div>
                </div>
                
                <div class="form-section" id="signupScheduleSection">
                    <h3 class="section-title">Signup Schedule</h3>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="signupScheduleToggle" ${settings.signupScheduleEnabled ? 'checked' : ''} onchange="toggleSignupSchedule()">
                            Enable Scheduled Signup Window
                        </label>
                        <p style="font-size:14px; color:#666; margin-top:5px;">Set a specific time window when signups are allowed</p>
                    </div>
                    
                    <div id="signupScheduleControls" style="${settings.signupScheduleEnabled ? '' : 'display:none;'} margin-top:15px;">
                        <div class="signup-schedule-card">
                            <h4>Schedule Signup Window</h4>
                            <div class="schedule-time-inputs">
                                <input type="datetime-local" id="signupScheduleStart" value="${settings.signupScheduleStart || ''}" placeholder="Start Date & Time">
                                <input type="datetime-local" id="signupScheduleEnd" value="${settings.signupScheduleEnd || ''}" placeholder="End Date & Time">
                            </div>
                            <p style="font-size:12px; color:rgba(255,255,255,0.8);">When the schedule ends, signups will automatically be enabled</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Sound Settings</h3>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="soundEnabledToggle" ${settings.soundEnabled !== false ? 'checked' : ''}>
                            Enable System Sounds
                        </label>
                        <p style="font-size:14px; color:#666; margin-top:5px;">Play sounds for notifications and system events</p>
                    </div>
                </div>
                
                <button class="btn btn-success btn-block" onclick="saveSystemSettings()">Save Settings</button>
            `;
        }

        // Toggle Signup Schedule
        function toggleSignupSchedule() {
            const scheduleToggle = document.getElementById('signupScheduleToggle');
            const scheduleControls = document.getElementById('signupScheduleControls');
            
            if (scheduleToggle.checked) {
                scheduleControls.style.display = 'block';
            } else {
                scheduleControls.style.display = 'none';
            }
        }

        // Save System Settings
        function saveSystemSettings() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            
            settings.maintenance = document.getElementById('settingsMaintenanceToggle').checked;
            settings.allowSignups = document.getElementById('allowSignupsToggle').checked;
            settings.allowPasswordReset = document.getElementById('allowPasswordResetToggle').checked;
            settings.soundEnabled = document.getElementById('soundEnabledToggle').checked;
            settings.signupScheduleEnabled = document.getElementById('signupScheduleToggle').checked;
            
            soundEnabled = settings.soundEnabled;
            
            const soundIcon = document.getElementById('soundIcon');
            const soundToggleBtn = document.getElementById('soundToggleBtn');
            if (soundIcon && soundToggleBtn) {
                if (soundEnabled) {
                    soundIcon.className = 'fas fa-volume-up';
                    soundToggleBtn.title = 'Sound: ON';
                } else {
                    soundIcon.className = 'fas fa-volume-mute';
                    soundToggleBtn.title = 'Sound: OFF';
                }
            }
            
            if (settings.signupScheduleEnabled) {
                settings.signupScheduleStart = document.getElementById('signupScheduleStart').value;
                settings.signupScheduleEnd = document.getElementById('signupScheduleEnd').value;
                
                if (settings.signupScheduleStart && settings.signupScheduleEnd) {
                    settings.allowSignups = false;
                    document.getElementById('allowSignupsToggle').checked = false;
                }
            } else {
                settings.signupScheduleStart = null;
                settings.signupScheduleEnd = null;
            }
            
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            
            const maintenanceToggle = document.getElementById('maintenanceToggle');
            const maintenanceStatus = document.getElementById('maintenanceStatus');
            if (maintenanceToggle && maintenanceStatus) {
                maintenanceToggle.checked = settings.maintenance;
                maintenanceStatus.textContent = settings.maintenance ? 'ON' : 'OFF';
            }
            
            updateSignupStatusBadge();
            checkSignupStatus();
            
            startScheduleTimer();
            
            showToast('Settings Saved', 'System settings have been updated.', 'success');
        }

        // Toggle Maintenance Mode
        function toggleMaintenanceMode() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            settings.maintenance = !settings.maintenance;
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            
            const maintenanceStatus = document.getElementById('maintenanceStatus');
            if (maintenanceStatus) {
                maintenanceStatus.textContent = settings.maintenance ? 'ON' : 'OFF';
            }
            
            if (settings.maintenance) {
                const users = JSON.parse(localStorage.getItem('users')) || [];
                const activeUsers = users.filter(u => u.status === 'active');
                
                activeUsers.forEach(user => {
                    createNotification(user.id, 'System Maintenance', 
                        'The system is currently under maintenance. Please try again later.', 'warning');
                });
                
                logActivity('admin', currentUser.id, 'Enabled maintenance mode');
            } else {
                logActivity('admin', currentUser.id, 'Disabled maintenance mode');
            }
            
            showToast('Maintenance Mode', `Maintenance mode ${settings.maintenance ? 'enabled' : 'disabled'}.`, 'success');
        }

        // Load Admin Profile
        function loadAdminProfile(container) {
            const admin = JSON.parse(localStorage.getItem('admin'));
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Admin Profile</h2>
                
                <div class="form-section">
                    <h3 class="section-title">Profile Information</h3>
                    <div style="text-align:center; margin-bottom:20px;">
                        <div class="avatar" id="profileAvatarPreview" style="width:100px; height:100px; margin:0 auto 15px; cursor:pointer;" onclick="openAvatarUpload()">
                            <div id="profileAvatarText" style="font-size:36px;">${admin.avatar}</div>
                        </div>
                        <button class="btn" onclick="openAvatarUpload()">Change Avatar</button>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Username</label>
                                <input type="text" id="adminProfileUsername" class="form-control" value="${admin.username}">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" id="adminProfileFullName" class="form-control" value="${admin.fullName}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Nickname</label>
                                <input type="text" id="adminProfileNickname" class="form-control" value="${admin.nickname}">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" id="adminProfileEmail" class="form-control" value="${admin.email}">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Phone</label>
                                <input type="tel" id="adminProfilePhone" class="form-control" value="${admin.phone}">
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="form-label">Country</label>
                                <input type="text" id="adminProfileCountry" class="form-control" value="${admin.country}">
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-success" onclick="updateAdminProfile()">Update Profile</button>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Change Password</h3>
                    <div class="form-group">
                        <label class="form-label">Current Password</label>
                        <input type="password" id="adminCurrentPassword" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">New Password</label>
                        <input type="password" id="adminNewPassword" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm New Password</label>
                        <input type="password" id="adminConfirmPassword" class="form-control">
                    </div>
                    <button class="btn btn-danger" onclick="updateAdminPassword()">Change Password</button>
                </div>
            `;
            
            const avatars = JSON.parse(localStorage.getItem('avatars')) || {};
            const avatarKey = admin.id;
            const avatarContainer = document.getElementById('profileAvatarPreview');
            const avatarText = document.getElementById('profileAvatarText');
            
            if (avatars[avatarKey]) {
                avatarText.style.display = 'none';
                if (!avatarContainer.querySelector('img')) {
                    const img = document.createElement('img');
                    img.className = 'avatar-img';
                    img.src = avatars[avatarKey];
                    avatarContainer.appendChild(img);
                } else {
                    avatarContainer.querySelector('img').src = avatars[avatarKey];
                }
            } else {
                avatarText.style.display = 'flex';
                const img = avatarContainer.querySelector('img');
                if (img) {
                    img.remove();
                }
            }
        }

        // Update Admin Profile
        function updateAdminProfile() {
            const admin = JSON.parse(localStorage.getItem('admin'));
            
            admin.username = document.getElementById('adminProfileUsername').value;
            admin.fullName = document.getElementById('adminProfileFullName').value;
            admin.nickname = document.getElementById('adminProfileNickname').value;
            admin.email = document.getElementById('adminProfileEmail').value;
            admin.phone = document.getElementById('adminProfilePhone').value;
            admin.country = document.getElementById('adminProfileCountry').value;
            admin.avatar = admin.username.charAt(0).toUpperCase();
            
            localStorage.setItem('admin', JSON.stringify(admin));
            
            if (currentUser && currentUser.id === admin.id) {
                currentUser = admin;
                localStorage.setItem('currentUser', JSON.stringify(admin));
                updateAdminUI();
            }
            
            logActivity('admin', admin.id, 'Updated admin profile');
            
            showToast('Profile Updated', 'Admin profile has been updated.', 'success');
        }

        // Update Admin Password
        function updateAdminPassword() {
            const currentPassword = document.getElementById('adminCurrentPassword').value;
            const newPassword = document.getElementById('adminNewPassword').value;
            const confirmPassword = document.getElementById('adminConfirmPassword').value;
            
            const admin = JSON.parse(localStorage.getItem('admin'));
            
            if (currentPassword !== admin.password) {
                showToast('Error', 'Current password is incorrect.', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('Error', 'New passwords do not match.', 'error');
                return;
            }
            
            admin.password = newPassword;
            admin.lastPasswordChange = new Date().toISOString();
            localStorage.setItem('admin', JSON.stringify(admin));
            
            if (currentUser && currentUser.id === admin.id) {
                currentUser = admin;
                localStorage.setItem('currentUser', JSON.stringify(admin));
            }
            
            logActivity('admin', admin.id, 'Changed admin password');
            
            document.getElementById('adminCurrentPassword').value = '';
            document.getElementById('adminNewPassword').value = '';
            document.getElementById('adminConfirmPassword').value = '';
            
            showToast('Password Changed', 'Admin password has been changed.', 'success');
        }

        // Load Activity Logs
        function loadActivityLogs(container) {
            const activities = JSON.parse(localStorage.getItem('activities')) || [];
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Activity Logs</h2>
                
                <div class="form-section">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h3 class="section-title">All Activities (${activities.length})</h3>
                        <div>
                            <input type="text" id="activitySearch" placeholder="Search activities..." class="form-control" style="display:inline-block; width:200px;">
                            <button class="btn" onclick="searchActivities()" style="margin-left:10px;">Search</button>
                            <button class="btn btn-danger" onclick="clearActivityLogs()" style="margin-left:10px;">
                                <i class="fas fa-trash"></i> Clear Logs
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>User Role</th>
                                    <th>User ID</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="activitiesTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            loadActivitiesTable(activities);
        }

        // Load Activities Table
        function loadActivitiesTable(activities) {
            const container = document.getElementById('activitiesTable');
            const sortedActivities = activities.slice().reverse();
            
            container.innerHTML = sortedActivities.map(activity => `
                <tr>
                    <td>${formatDate(activity.timestamp)}</td>
                    <td>${activity.userRole}</td>
                    <td>${activity.userId}</td>
                    <td>${activity.action}</td>
                </tr>
            `).join('');
        }

        // Search Activities
        function searchActivities() {
            const searchTerm = document.getElementById('activitySearch').value.toLowerCase();
            const activities = JSON.parse(localStorage.getItem('activities')) || [];
            const filteredActivities = activities.filter(activity => 
                activity.userRole.toLowerCase().includes(searchTerm) ||
                activity.userId.toLowerCase().includes(searchTerm) ||
                activity.action.toLowerCase().includes(searchTerm)
            );
            
            loadActivitiesTable(filteredActivities);
        }

        // Clear Activity Logs
        function clearActivityLogs() {
            showConfirmation('Clear Activity Logs', 'Are you sure you want to clear all activity logs? This action cannot be undone.', () => {
                localStorage.setItem('activities', JSON.stringify([]));
                
                logActivity('admin', currentUser.id, 'Cleared all activity logs');
                
                showToast('Logs Cleared', 'All activity logs have been cleared.', 'success');
                loadActivityLogs(document.getElementById('adminContent'));
            });
        }

        // Load Backup Restore
        function loadBackupRestore(container) {
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Backup & Restore</h2>
                
                <div class="form-section">
                    <h3 class="section-title">Create Backup</h3>
                    <p style="margin-bottom:15px; color:#666;">Create a backup of all system data including users and settings.</p>
                    <button class="btn btn-success" onclick="createSystemBackup()">
                        <i class="fas fa-download"></i> Create Backup
                    </button>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Restore Backup</h3>
                    <p style="margin-bottom:15px; color:#666;">Restore system data from a previous backup file.</p>
                    <input type="file" id="backupFileInput" accept=".json" style="margin-bottom:15px;">
                    <button class="btn btn-warning" onclick="restoreSystemBackup()">
                        <i class="fas fa-upload"></i> Restore Backup
                    </button>
                    <p style="font-size:12px; color:#f8961e; margin-top:10px;">
                        <i class="fas fa-exclamation-triangle"></i> Warning: This will overwrite existing data.
                    </p>
                </div>
            `;
        }

        // Create System Backup
        function createSystemBackup() {
            showLoading('Creating backup...');
            
            setTimeout(() => {
                const backupData = {
                    timestamp: new Date().toISOString(),
                    version: '1.0',
                    data: {
                        users: JSON.parse(localStorage.getItem('users')),
                        notifications: JSON.parse(localStorage.getItem('notifications')),
                        activities: JSON.parse(localStorage.getItem('activities')),
                        passwordRequests: JSON.parse(localStorage.getItem('passwordRequests')),
                        systemSettings: JSON.parse(localStorage.getItem('systemSettings')),
                        userSettings: JSON.parse(localStorage.getItem('userSettings')),
                        avatars: JSON.parse(localStorage.getItem('avatars')),
                        admin: JSON.parse(localStorage.getItem('admin'))
                    }
                };
                
                const dataStr = JSON.stringify(backupData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `system_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                logActivity('admin', currentUser.id, 'Created system backup');
                
                hideLoading();
                showToast('Backup Created', 'System backup has been downloaded.', 'success');
            }, 1000);
        }

        // Restore System Backup
        function restoreSystemBackup() {
            const fileInput = document.getElementById('backupFileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showToast('Error', 'Please select a backup file first.', 'error');
                return;
            }
            
            showConfirmation('Restore Backup', 'Are you sure you want to restore from backup? This will overwrite all current data.', () => {
                showLoading('Restoring backup...');
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backupData = JSON.parse(e.target.result);
                        
                        if (!backupData.data || !backupData.timestamp) {
                            throw new Error('Invalid backup file format');
                        }
                        
                        if (backupData.data.users) localStorage.setItem('users', JSON.stringify(backupData.data.users));
                        if (backupData.data.notifications) localStorage.setItem('notifications', JSON.stringify(backupData.data.notifications));
                        if (backupData.data.activities) localStorage.setItem('activities', JSON.stringify(backupData.data.activities));
                        if (backupData.data.passwordRequests) localStorage.setItem('passwordRequests', JSON.stringify(backupData.data.passwordRequests));
                        if (backupData.data.systemSettings) localStorage.setItem('systemSettings', JSON.stringify(backupData.data.systemSettings));
                        if (backupData.data.userSettings) localStorage.setItem('userSettings', JSON.stringify(backupData.data.userSettings));
                        if (backupData.data.avatars) localStorage.setItem('avatars', JSON.stringify(backupData.data.avatars));
                        if (backupData.data.admin) localStorage.setItem('admin', JSON.stringify(backupData.data.admin));
                        
                        logActivity('admin', currentUser.id, 'Restored system from backup');
                        
                        hideLoading();
                        showToast('Backup Restored', 'System data has been restored from backup.', 'success');
                        
                        setTimeout(() => {
                            location.reload();
                        }, 2000);
                    } catch (error) {
                        hideLoading();
                        showToast('Restore Error', 'Failed to restore backup. Invalid file format.', 'error');
                    }
                };
                reader.readAsText(file);
            });
        }

        // Load User Page
        function loadUserPage(page) {
            currentPage = page;
            const contentArea = document.getElementById('userContent');
            
            contentArea.innerHTML = `
                <div style="margin-bottom:20px;">
                    <div class="skeleton skeleton-text" style="width:200px; height:30px;"></div>
                </div>
                <div class="dashboard-cards">
                    ${Array(3).fill().map(() => `
                        <div class="card">
                            <div class="card-header">
                                <div class="skeleton skeleton-text" style="width:100px;"></div>
                                <div class="skeleton" style="width:24px; height:24px;"></div>
                            </div>
                            <div class="skeleton skeleton-text" style="width:80px; height:32px;"></div>
                            <div class="skeleton skeleton-text" style="width:120px;"></div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            setTimeout(() => {
                switch(page) {
                    case 'userDashboard':
                        loadUserDashboard(contentArea);
                        break;
                    case 'userProfile':
                        loadUserProfilePage(contentArea);
                        break;
                    case 'editProfile':
                        loadEditProfilePage(contentArea);
                        break;
                    case 'userNotifications':
                        loadUserNotifications(contentArea);
                        break;
                    case 'changePassword':
                        loadChangePasswordPage(contentArea);
                        break;
                    case 'appearance':
                        loadAppearancePage(contentArea);
                        break;
                    case 'settings':
                        loadUserSettingsPage(contentArea);
                        break;
                }
            }, 500);
        }

        // Load User Dashboard
        function loadUserDashboard(container) {
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            
            const unreadNotifications = notifications.filter(n => 
                n.recipient === currentUser.id && !n.read
            ).length;
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">User Dashboard</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${currentUser.status}</div>
                        <div class="stat-label">Account Status</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${unreadNotifications}</div>
                        <div class="stat-label">Unread Notifications</div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Quick Actions</h3>
                    <div style="display:flex; gap:15px; flex-wrap:wrap;">
                        <button class="btn btn-success" onclick="loadUserPage('userProfile')">
                            <i class="fas fa-user"></i> View Profile
                        </button>
                        <button class="btn btn-warning" onclick="loadUserPage('changePassword')">
                            <i class="fas fa-key"></i> Change Password
                        </button>
                        <button class="btn" onclick="loadUserPage('appearance')">
                            <i class="fas fa-palette"></i> Appearance
                        </button>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Recent Activity</h3>
                    <div id="userRecentActivities" class="activity-timeline">
                    </div>
                </div>
            `;
            
            loadUserRecentActivities();
        }

        // Load User Recent Activities
        function loadUserRecentActivities() {
            const activities = JSON.parse(localStorage.getItem('activities')) || [];
            const userActivities = activities.filter(a => a.userId === currentUser.id).slice(-5).reverse();
            const container = document.getElementById('userRecentActivities');
            
            if (userActivities.length === 0) {
                container.innerHTML = '<p>No recent activities.</p>';
                return;
            }
            
            container.innerHTML = userActivities.map(activity => `
                <div class="activity-item">
                    <div class="activity-time">${formatDate(activity.timestamp, true)}</div>
                    <div class="activity-text">${activity.action}</div>
                </div>
            `).join('');
        }

        // Load User Profile Page
        function loadUserProfilePage(container) {
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Your Profile</h2>
                
                <div class="form-section">
                    <div style="text-align:center; margin-bottom:20px;">
                        <div class="avatar" id="userProfileAvatar" style="width:120px; height:120px; margin:0 auto 15px; cursor:pointer;" onclick="openAvatarUpload()">
                            <div id="userProfileAvatarText" style="font-size:48px;">${currentUser.avatar}</div>
                        </div>
                        <button class="btn" onclick="openAvatarUpload()">Change Avatar</button>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">
                        <div>
                            <h4 style="margin-bottom:10px;">Personal Information</h4>
                            <p><strong>Username:</strong> ${currentUser.username}</p>
                            <p><strong>Full Name:</strong> ${currentUser.fullName}</p>
                            <p><strong>Nickname:</strong> ${currentUser.nickname}</p>
                            <p><strong>Email:</strong> ${currentUser.email}</p>
                            <p><strong>Phone:</strong> ${currentUser.countryCode} ${currentUser.phone}</p>
                        </div>
                        
                        <div>
                            <h4 style="margin-bottom:10px;">Account Information</h4>
                            <p><strong>Status:</strong> <span class="status-badge ${getStatusClass(currentUser.status)}">${currentUser.status}</span></p>
                            <p><strong>Country:</strong> ${currentUser.country}</p>
                            <p><strong>Date of Birth:</strong> ${currentUser.dob}</p>
                            <p><strong>Gender:</strong> ${currentUser.gender}</p>
                            <p><strong>Registered:</strong> ${formatDate(currentUser.createdAt)}</p>
                            <p><strong>Last Login:</strong> ${currentUser.lastLogin ? formatDate(currentUser.lastLogin) : 'Never'}</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Login History</h3>
                    <div id="userLoginHistory" class="activity-timeline">
                    </div>
                </div>
            `;
            
            const avatars = JSON.parse(localStorage.getItem('avatars')) || {};
            const avatarKey = currentUser.id;
            const avatarContainer = document.getElementById('userProfileAvatar');
            const avatarText = document.getElementById('userProfileAvatarText');
            
            if (avatars[avatarKey]) {
                avatarText.style.display = 'none';
                if (!avatarContainer.querySelector('img')) {
                    const img = document.createElement('img');
                    img.className = 'avatar-img';
                    img.src = avatars[avatarKey];
                    avatarContainer.appendChild(img);
                } else {
                    avatarContainer.querySelector('img').src = avatars[avatarKey];
                }
            } else {
                avatarText.style.display = 'flex';
                const img = avatarContainer.querySelector('img');
                if (img) {
                    img.remove();
                }
            }
            
            loadUserLoginHistory();
        }

        // Load User Login History
        function loadUserLoginHistory() {
            const loginHistory = currentUser.loginHistory || [];
            const container = document.getElementById('userLoginHistory');
            const sortedHistory = loginHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).slice(0, 10);
            
            if (sortedHistory.length === 0) {
                container.innerHTML = '<p>No login history available.</p>';
                return;
            }
            
            container.innerHTML = sortedHistory.map(entry => `
                <div class="activity-item">
                    <div class="activity-time">${formatDate(entry.timestamp)}</div>
                    <div class="activity-text">${entry.action === 'login' ? 'Logged in' : 'Logged out'}</div>
                </div>
            `).join('');
        }

        // Load Edit Profile Page
        function loadEditProfilePage(container) {
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Edit Profile</h2>
                
                <div class="form-section">
                    <form id="editProfileForm">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Username</label>
                                    <input type="text" id="editUsername" class="form-control" value="${currentUser.username}" readonly>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Full Name</label>
                                    <input type="text" id="editFullName" class="form-control" value="${currentUser.fullName}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Nickname</label>
                                    <input type="text" id="editNickname" class="form-control" value="${currentUser.nickname}">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" id="editEmail" class="form-control" value="${currentUser.email}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Phone</label>
                                    <input type="tel" id="editPhone" class="form-control" value="${currentUser.phone}">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Country</label>
                                    <input type="text" id="editCountry" class="form-control" value="${currentUser.country}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Country Code</label>
                                    <input type="text" id="editCountryCode" class="form-control" value="${currentUser.countryCode}">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Date of Birth</label>
                                    <input type="date" id="editDob" class="form-control" value="${currentUser.dob}">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="form-label">Gender</label>
                                    <select id="editGender" class="form-control">
                                        <option value="male" ${currentUser.gender === 'male' ? 'selected' : ''}>Male</option>
                                        <option value="female" ${currentUser.gender === 'female' ? 'selected' : ''}>Female</option>
                                        <option value="other" ${currentUser.gender === 'other' ? 'selected' : ''}>Other</option>
                                        <option value="prefer-not-to-say" ${currentUser.gender === 'prefer-not-to-say' ? 'selected' : ''}>Prefer not to say</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-success btn-block" onclick="updateUserProfile()">Update Profile</button>
                    </form>
                </div>
            `;
        }

        // Update User Profile
        function updateUserProfile() {
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                users[userIndex].fullName = document.getElementById('editFullName').value;
                users[userIndex].nickname = document.getElementById('editNickname').value;
                users[userIndex].email = document.getElementById('editEmail').value;
                users[userIndex].phone = document.getElementById('editPhone').value;
                users[userIndex].country = document.getElementById('editCountry').value;
                users[userIndex].countryCode = document.getElementById('editCountryCode').value;
                users[userIndex].dob = document.getElementById('editDob').value;
                users[userIndex].gender = document.getElementById('editGender').value;
                users[userIndex].avatar = users[userIndex].username.charAt(0).toUpperCase();
                
                localStorage.setItem('users', JSON.stringify(users));
                
                currentUser = users[userIndex];
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserUI();
                
                logActivity('user', currentUser.id, 'Updated profile information');
                
                showToast('Profile Updated', 'Your profile has been updated.', 'success');
            }
        }

        // Load User Notifications
        function loadUserNotifications(container) {
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            const userNotifications = notifications.filter(n => n.recipient === currentUser.id).sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Notifications</h2>
                
                <div class="form-section">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                        <h3 class="section-title">All Notifications</h3>
                        <button class="btn" onclick="markAllNotificationsAsRead()">
                            <i class="fas fa-check-double"></i> Mark All as Read
                        </button>
                    </div>
                    <div id="userNotificationsList">
                    </div>
                </div>
            `;
            
            loadUserNotificationsList(userNotifications);
        }

        // Load User Notifications List
        function loadUserNotificationsList(notifications) {
            const container = document.getElementById('userNotificationsList');
            
            if (notifications.length === 0) {
                container.innerHTML = '<p>No notifications.</p>';
                return;
            }
            
            container.innerHTML = notifications.map(notif => `
                <div class="friend-request-item" style="${notif.read ? 'opacity:0.7;' : ''}">
                    <div>
                        <div style="font-weight:600;">${notif.title}</div>
                        <div style="font-size:14px; margin:5px 0;">${notif.message}</div>
                        <div style="font-size:12px; color:#666;">${formatDate(notif.timestamp, true)}</div>
                    </div>
                    <div class="friend-request-actions">
                        ${!notif.read ? `
                            <button class="btn btn-success" onclick="markNotificationAsRead('${notif.id}')" style="padding:5px 10px; font-size:12px;">
                                Mark Read
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Load Change Password Page
        function loadChangePasswordPage(container) {
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Change Password</h2>
                
                <div class="form-section">
                    <form id="userChangePasswordForm">
                        <div class="form-group">
                            <label class="form-label">Current Password</label>
                            <input type="password" id="userCurrentPassword" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">New Password</label>
                            <input type="password" id="userNewPassword" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Confirm New Password</label>
                            <input type="password" id="userConfirmPassword" class="form-control">
                        </div>
                        <button type="button" class="btn btn-danger btn-block" onclick="updateUserPassword()">Change Password</button>
                    </form>
                </div>
            `;
        }

        // Update User Password
        function updateUserPassword() {
            const currentPassword = document.getElementById('userCurrentPassword').value;
            const newPassword = document.getElementById('userNewPassword').value;
            const confirmPassword = document.getElementById('userConfirmPassword').value;
            
            if (currentPassword !== currentUser.password) {
                showToast('Error', 'Current password is incorrect.', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('Error', 'New passwords do not match.', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex !== -1) {
                users[userIndex].password = newPassword;
                users[userIndex].lastPasswordChange = new Date().toISOString();
                localStorage.setItem('users', JSON.stringify(users));
                
                currentUser = users[userIndex];
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                logActivity('user', currentUser.id, 'Changed password');
                
                createNotification('admin', 'Password Changed', 
                    `User ${currentUser.username} has changed their password.`, 'info');
                
                document.getElementById('userCurrentPassword').value = '';
                document.getElementById('userNewPassword').value = '';
                document.getElementById('userConfirmPassword').value = '';
                
                showToast('Password Changed', 'Your password has been changed successfully.', 'success');
            }
        }

        // Load Appearance Page
        function loadAppearancePage(container) {
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Appearance Settings</h2>
                
                <div class="form-section">
                    <h3 class="section-title">Theme Settings</h3>
                    <p style="margin-bottom:15px; color:#666;">Customize the look and feel of the application.</p>
                    <button class="btn btn-success btn-block" onclick="openBackgroundModal()">
                        <i class="fas fa-palette"></i> Customize Appearance
                    </button>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Sound Settings</h3>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="userSoundToggle" ${soundEnabled ? 'checked' : ''} onchange="toggleUserSound()">
                            Enable Sounds
                        </label>
                        <p style="font-size:14px; color:#666; margin-top:5px;">Play sounds for notifications and system events</p>
                    </div>
                    <button class="btn btn-success" onclick="saveUserSoundSettings()">Save Sound Settings</button>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Current Settings</h3>
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px;">
                        <div class="card">
                            <h4 style="margin-bottom:10px;">Theme</h4>
                            <p id="currentTheme">Loading...</p>
                        </div>
                        <div class="card">
                            <h4 style="margin-bottom:10px;">Brightness</h4>
                            <p id="currentBrightness">Loading...</p>
                        </div>
                        <div class="card">
                            <h4 style="margin-bottom:10px;">Mode</h4>
                            <p id="currentMode">Loading...</p>
                        </div>
                        <div class="card">
                            <h4 style="margin-bottom:10px;">Sound</h4>
                            <p id="currentSound">${soundEnabled ? 'Enabled' : 'Disabled'}</p>
                        </div>
                    </div>
                </div>
            `;
            
            updateAppearanceInfo();
        }

        // Toggle User Sound
        function toggleUserSound() {
            soundEnabled = document.getElementById('userSoundToggle').checked;
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            settings.soundEnabled = soundEnabled;
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            
            const soundIcon = document.getElementById('soundIcon');
            const soundToggleBtn = document.getElementById('soundToggleBtn');
            if (soundIcon && soundToggleBtn) {
                if (soundEnabled) {
                    soundIcon.className = 'fas fa-volume-up';
                    soundToggleBtn.title = 'Sound: ON';
                    playSound('success');
                } else {
                    soundIcon.className = 'fas fa-volume-mute';
                    soundToggleBtn.title = 'Sound: OFF';
                }
            }
            
            document.getElementById('currentSound').textContent = soundEnabled ? 'Enabled' : 'Disabled';
        }

        // Save User Sound Settings
        function saveUserSoundSettings() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            settings.soundEnabled = document.getElementById('userSoundToggle').checked;
            localStorage.setItem('systemSettings', JSON.stringify(settings));
            
            soundEnabled = settings.soundEnabled;
            
            const soundIcon = document.getElementById('soundIcon');
            const soundToggleBtn = document.getElementById('soundToggleBtn');
            if (soundIcon && soundToggleBtn) {
                if (soundEnabled) {
                    soundIcon.className = 'fas fa-volume-up';
                    soundToggleBtn.title = 'Sound: ON';
                } else {
                    soundIcon.className = 'fas fa-volume-mute';
                    soundToggleBtn.title = 'Sound: OFF';
                }
            }
            
            showToast('Settings Saved', 'Sound settings have been updated.', 'success');
        }

        // Update Appearance Info
        function updateAppearanceInfo() {
            const settings = JSON.parse(localStorage.getItem('systemSettings'));
            
            document.getElementById('currentTheme').textContent = settings.background.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('currentBrightness').textContent = `${settings.brightness}%`;
            document.getElementById('currentMode').textContent = settings.darkMode ? 'Dark Mode' : 'Light Mode';
            document.getElementById('currentSound').textContent = soundEnabled ? 'Enabled' : 'Disabled';
        }

        // Load User Settings Page
        function loadUserSettingsPage(container) {
            const userSettings = JSON.parse(localStorage.getItem('userSettings')) || {};
            const currentUserSettings = userSettings[currentUser.id] || {};
            
            container.innerHTML = `
                <h2 style="margin-bottom:20px;">Settings</h2>
                
                <div class="form-section">
                    <h3 class="section-title">Privacy Settings</h3>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="userShowOnlineStatus" ${currentUserSettings.showOnlineStatus !== false ? 'checked' : ''}>
                            Show Online Status
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="userShowInSearch" ${currentUserSettings.showInSearch !== false ? 'checked' : ''}>
                            Show Profile in Search
                        </label>
                    </div>
                    <button class="btn btn-success" onclick="saveUserPrivacySettings()">Save Privacy Settings</button>
                </div>
                
                <div class="form-section">
                    <h3 class="section-title">Notification Preferences</h3>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="userSystemNotifications" ${currentUserSettings.systemNotifications !== false ? 'checked' : ''}>
                            System Notifications
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="userSoundNotifications" ${currentUserSettings.soundNotifications !== false ? 'checked' : ''}>
                            Sound Notifications
                        </label>
                    </div>
                    <button class="btn btn-success" onclick="saveUserNotificationSettings()">Save Notification Settings</button>
                </div>
            `;
        }

        // Save User Privacy Settings
        function saveUserPrivacySettings() {
            const userSettings = JSON.parse(localStorage.getItem('userSettings')) || {};
            userSettings[currentUser.id] = userSettings[currentUser.id] || {};
            
            userSettings[currentUser.id].showOnlineStatus = document.getElementById('userShowOnlineStatus').checked;
            userSettings[currentUser.id].showInSearch = document.getElementById('userShowInSearch').checked;
            
            localStorage.setItem('userSettings', JSON.stringify(userSettings));
            showToast('Settings Saved', 'Privacy settings have been updated.', 'success');
        }

        // Save User Notification Settings
        function saveUserNotificationSettings() {
            const userSettings = JSON.parse(localStorage.getItem('userSettings')) || {};
            userSettings[currentUser.id] = userSettings[currentUser.id] || {};
            
            userSettings[currentUser.id].systemNotifications = document.getElementById('userSystemNotifications').checked;
            userSettings[currentUser.id].soundNotifications = document.getElementById('userSoundNotifications').checked;
            
            localStorage.setItem('userSettings', JSON.stringify(userSettings));
            showToast('Settings Saved', 'Notification settings have been updated.', 'success');
        }

        // Helper Functions

        // Format Date
        function formatDate(dateString, showTime = false) {
            const date = new Date(dateString);
            if (showTime) {
                return date.toLocaleString();
            }
            return date.toLocaleDateString();
        }

        // Create Notification
        function createNotification(recipient, title, message, type = 'info') {
            const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
            const newNotification = {
                id: 'notif-' + Date.now(),
                recipient: recipient,
                title: title,
                message: message,
                type: type,
                timestamp: new Date().toISOString(),
                read: false
            };
            notifications.push(newNotification);
            localStorage.setItem('notifications', JSON.stringify(notifications));
            
            if (soundEnabled) {
                playSound('notification');
            }
        }

        // Log Activity
        function logActivity(userRole, userId, action) {
            const activities = JSON.parse(localStorage.getItem('activities')) || [];
            activities.push({
                id: 'act-' + Date.now(),
                userRole: userRole,
                userId: userId,
                action: action,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('activities', JSON.stringify(activities));
        }

        // Show Confirmation Modal
        function showConfirmation(title, message, confirmCallback, infoOnly = false) {
            document.getElementById('confirmationTitle').textContent = title;
            document.getElementById('confirmationMessage').innerHTML = message;
            
            const confirmBtn = document.getElementById('confirmActionBtn');
            if (infoOnly) {
                confirmBtn.style.display = 'none';
            } else {
                confirmBtn.style.display = 'block';
                currentAction = confirmCallback;
            }
            
            showModal('confirmationModal');
        }

        // Confirm Action
        function confirmAction() {
            if (currentAction) {
                currentAction();
            }
            closeModal('confirmationModal');
            currentAction = null;
        }

        // Close Media Viewer
        function closeMediaViewer() {
            document.getElementById('mediaViewer').classList.remove('active');
        }

        // Logout
        function logout() {
            if (currentUser) {
                currentUser.lastLogout = new Date().toISOString();
                currentUser.online = false;
                
                if (currentUser.role === 'admin') {
                    localStorage.setItem('admin', JSON.stringify(currentUser));
                } else {
                    const users = JSON.parse(localStorage.getItem('users'));
                    const userIndex = users.findIndex(u => u.id === currentUser.id);
                    if (userIndex !== -1) {
                        users[userIndex] = currentUser;
                        localStorage.setItem('users', JSON.stringify(users));
                    }
                }
                
                logActivity(currentUser.role, currentUser.id, 'User logged out');
                
                if (soundEnabled) {
                    playSound('logout');
                }
                
                localStorage.removeItem('currentUser');
            }
            
            if (adminScheduleInterval) {
                clearInterval(adminScheduleInterval);
                adminScheduleInterval = null;
            }
            
            if (signupCountdownInterval) {
                clearInterval(signupCountdownInterval);
                signupCountdownInterval = null;
            }
            
            document.getElementById('adminHomepage').style.display = 'none';
            document.getElementById('userHomepage').style.display = 'none';
            
            document.getElementById('loginPage').style.display = 'flex';
            
            currentUser = null;
            
            showToast('Logged Out', 'You have been successfully logged out.', 'success');
        }

        // Open Media Viewer
        function openMediaViewer(mediaSrc, mediaType) {
            const viewer = document.getElementById('mediaViewer');
            const content = document.getElementById('mediaViewerContent');
            
            if (mediaType === 'image') {
                content.innerHTML = `<img src="${mediaSrc}" alt="Media">`;
            } else if (mediaType === 'video') {
                content.innerHTML = `<video controls><source src="${mediaSrc}" type="video/mp4"></video>`;
            }
            
            viewer.classList.add('active');
        }
    </script>
</body>
</html>
